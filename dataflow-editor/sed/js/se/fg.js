var Fg=function(t){var z=this;z.sed=t,z.unitWidth=45,z.unitHeight=30,z.clientRects={},z.svg=t.svg,z.tagName="",z.selected=!1,z.options={fgRef:"",figureId:0,x:0,y:0,xCalc:0,yCalc:0,width:200,heigth:100,fill:"yellow",stroke:"orange",strokeWidth:1,text:"TEXT",textFill:"black",textSize:12,textHAlign:"center",textVAlign:"middle",parentLayer:null,parentGroup:null,rotate:0,lineMoveMode:"A",lineMoveDir:[],lineMovePos:[],joinDotsPos:[],joinDotsPosCalc:[],joinDotsPosData:[],connected:[],connectedId:[],connectedIndex:[],rulerConnectedHor:[],rulerConnectedIdHor:[],rulerConnectedIndexHor:[],rulerConnectedVer:[],rulerConnectedIdVer:[],rulerConnectedIndexVer:[],rotateDotPos:{},rotateDotPosCalc:{},dotsPos:[],dotsPosCalc:[],dotsIndex:[],leftMax:0,rightMax:0,topMax:0,bottomMax:0,x1:0,y1:0,x2:0,y2:0},z.createFg=function(t){if("selectedRectangle"==t.figure){var o=this,e=this.sed;o.svg=e.svg,o.editMode=e.editMode,0==this.sed.editMode?o.editVisible="hidden":o.editVisible="visible",o.tagName=t.figure,o.options=t,o.rotate=t.rotate;var s=document.createElementNS("http://www.w3.org/2000/svg","g");s.setAttribute("xmlns","http://www.w3.org/2000/svg");var i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("xmlns","http://www.w3.org/2000/svg"),i.oncontextmenu=function(){return!1},i.setAttribute("x",o.options.width/2*-1),i.setAttribute("y",o.options.height/2*-1),i.setAttribute("width",o.options.width),i.setAttribute("height",o.options.height),i.setAttribute("baseFg",!1),i.setAttribute("stroke",o.options.stroke),null!=o.options.strokeDasharray&&i.setAttribute("stroke-dasharray",o.options.strokeDasharray),i.setAttribute("stroke-width",o.options.strokeWidth),i.setAttribute("stroke-dasharray",o.options.strokeDasharray),i.setAttribute("fill",o.options.fill),i.setAttribute("fill-opacity",o.options.fillOpacity),i.setAttribute("stroke-opacity",o.options.strokeOpacity),i.setAttribute("visibility","visible"),o.options.dotsPos=[],o.options.dotsPos.push({x:o.options.width/2*0,y:o.options.height/2*-1}),o.options.dotsPos.push({x:o.options.width/2*1,y:o.options.height/2*-1}),o.options.dotsPos.push({x:o.options.width/2*1,y:o.options.height/2*0}),o.options.dotsPos.push({x:o.options.width/2*1,y:o.options.height/2*1}),o.options.dotsPos.push({x:o.options.width/2*0,y:o.options.height/2*1}),o.options.dotsPos.push({x:o.options.width/2*-1,y:o.options.height/2*1}),o.options.dotsPos.push({x:o.options.width/2*-1,y:o.options.height/2*0}),o.options.dotsPos.push({x:o.options.width/2*-1,y:o.options.height/2*-1}),o.options.dotsPosCalc=[],o.options.dotsPosCalc.push({}),o.options.dotsPosCalc.push({}),o.options.dotsPosCalc.push({}),o.options.dotsPosCalc.push({}),o.options.dotsPosCalc.push({}),o.options.dotsPosCalc.push({}),o.options.dotsPosCalc.push({}),o.options.dotsPosCalc.push({}),o.options.joinDotsPos=[],o.options.joinDotsPos.push({x:o.options.width/2*0,y:o.options.height/2*-1,dir:"N"}),o.options.joinDotsPos.push({x:o.options.width/2*1,y:o.options.height/2*-1,dir:"NE"}),o.options.joinDotsPos.push({x:o.options.width/2*1,y:o.options.height/2*0,dir:"E"}),o.options.joinDotsPos.push({x:o.options.width/2*1,y:o.options.height/2*1,dir:"SE"}),o.options.joinDotsPos.push({x:o.options.width/2*0,y:o.options.height/2*1,dir:"S"}),o.options.joinDotsPos.push({x:o.options.width/2*-1,y:o.options.height/2*1,dir:"SW"}),o.options.joinDotsPos.push({x:o.options.width/2*-1,y:o.options.height/2*0,dir:"W"}),o.options.joinDotsPos.push({x:o.options.width/2*-1,y:o.options.height/2*-1,dir:"NW"}),o.options.joinDotsPosCalc=[],o.options.joinDotsPosCalc.push({}),o.options.joinDotsPosCalc.push({}),o.options.joinDotsPosCalc.push({}),o.options.joinDotsPosCalc.push({}),o.options.joinDotsPosCalc.push({}),o.options.joinDotsPosCalc.push({}),o.options.joinDotsPosCalc.push({}),o.options.joinDotsPosCalc.push({}),o.options.joinDotsPosData=[],o.options.joinDotsPosData.push({x:0,y:-50,dir:"N"}),o.options.joinDotsPosData.push({x:50,y:-50,dir:"NE"}),o.options.joinDotsPosData.push({x:50,y:0,dir:"E"}),o.options.joinDotsPosData.push({x:50,y:50,dir:"SE"}),o.options.joinDotsPosData.push({x:0,y:50,dir:"S"}),o.options.joinDotsPosData.push({x:-50,y:50,dir:"SW"}),o.options.joinDotsPosData.push({x:-50,y:0,dir:"W"}),o.options.joinDotsPosData.push({x:-50,y:-50,dir:"NW"}),s.appendChild(i),o.svg.appendChild(s),o.group=s,o.group.oncontextmenu=function(){return!1},o.group.tag=i,(o.group.fg=o).group.dots=[];for(var n=0;n<o.options.dotsPos.length;n++){var a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("xmlns","http://www.w3.org/2000/svg"),a.setAttribute("cx",o.options.dotsPos[n].x),a.setAttribute("cy",o.options.dotsPos[n].y),a.setAttribute("fill-opacity",1),a.setAttribute("r",5),a.setAttribute("stroke","black"),a.setAttribute("fill","orange"),a.setAttribute("visibility","visible"),a.setAttribute("dotIndex",n),s.appendChild(a),o.group.dots.push(a)}return o.active(),null!=o.svg.selectedFg&&o.svg.selectedFg.hideDot(),o.svg.selectedFg=o,(e.svg.selectedFg=o).rotateFg(0,!1),o.draw(130),o.drawText(4),o}if(1==this.options.base3d){if(null!=this.sed.svg.selectedLayer&&"layer"==this.sed.svg.selectedLayer.options.tagName)return void alert("3D shapes can be created by adding or selecting 3D layers. Add 3D layers in the left layer settings before working on them.")}else if(null!=this.sed.svg.selectedLayer&&"layer3d"==this.sed.svg.selectedLayer.options.tagName)return void alert("You can add or create common shapes on 3D layers. Add layers in the left normal layer settings, then work.");o=this,e=this.sed;if(o.svg=e.svg,o.editMode=e.editMode,0==this.sed.editMode?o.editVisible="hidden":o.editVisible="visible",o.tagName=t.figure,o.options=t,o.rotate=t.rotate,null==setTagsShape(o,t,!0,1))return null;if(o.active(),o.rulerConnectedHor=[],o.rulerConnectedIdHor=[],o.rulerConnectedIndexHor=[],o.rulerConnectedVer=[],o.rulerConnectedIdVer=[],o.rulerConnectedIndexVer=[],o.options.topDotPosData={x:0,y:0},o.options.bottomDotPosData={x:0,y:0},null!=o.options.userData&&null!=o.options.userData||(o.options.userData={}),o.options.userData.set=function(t,e){o.options.userData[t]=e},o.options.userData.get=function(t){return o.options.userData[t]},o.getUserData=function(){return o.options.userData},o.setUserData=function(t,e){o.options.userData[t]=e},null!=o.svg.selectedFg&&o.svg.selectedFg.hideDot(),1==o.options.sameWh&&null!=o.group.dots)for(n=0;n<o.group.dots.length;n++)n%2==1&&o.group.dots[n].setAttribute("visibility","hidden");return o.svg.selectedFg=o,e.svg.selectedFg=o},z.setGroupArea=function(){for(var t=sedLib.getPosCalcOnly(z),e=0;e<t.length;e++)z.options.groupLeft>t[e].x&&(z.options.groupLeft=t[e].x),z.options.groupRight<t[e].x&&(z.options.groupRight=t[e].x),z.options.groupTop>t[e].y&&(z.options.groupTop=t[e].y),z.options.groupBottom<t[e].y&&(z.options.groupBottom=t[e].y)},z.redraw=function(t){null!=this.group.tag&&null!=this.group.tag&&(this.group.tag.setAttribute("stroke-width",this.get("strokeWidth")),this.group.tag.setAttribute("stroke-dasharray",this.get("strokeDasharray")),this.group.tag.setAttribute("stroke",this.get("stroke")),"basicPathDot"==z.tagName?this.group.tag.setAttribute("fill","none"):"freeline"==z.tagName&&1==z.options.closePath?(this.group.tag.setAttribute("fill",this.get("fill")),this.group.tag.setAttribute("fill-opacity",this.get("fillOpacity"))):"line"==z.tagName||"flowline"==z.tagName||"flowline3d"==z.tagName||"freeline"==z.tagName?this.group.tag.setAttribute("fill","none"):(this.group.tag.setAttribute("fill",this.get("fill")),this.group.tag.setAttribute("fill-opacity",this.get("fillOpacity"))),this.group.tag.setAttribute("stroke-opacity",this.get("strokeOpacity")),null!=this.group.subTag1&&(this.group.subTag1.setAttribute("stroke-width",this.get("strokeWidth")),"line"!=this.tagName&&"flowline"!=this.tagName&&"freeline"!=this.tagName&&"basicPathDot"!=this.tagName&&null!=this.group.subTag1.getAttribute("stroke-dasharray")&&"none"!=this.group.subTag1.getAttribute("stroke-dasharray")&&this.group.subTag1.setAttribute("stroke-dasharray",this.get("strokeDasharray")),this.group.subTag1.setAttribute("stroke",this.get("stroke")),this.group.subTag1.setAttribute("fill",this.get("fill")),this.group.subTag1.setAttribute("fill-opacity",this.get("fillOpacity")),this.group.subTag1.setAttribute("stroke-opacity",this.get("strokeOpacity"))),null!=this.group.subTag2&&(this.group.subTag2.setAttribute("stroke-width",this.get("strokeWidth")),"line"!=this.tagName&&"flowline"!=this.tagName&&"freeline"!=this.tagName&&null!=this.group.subTag2.getAttribute("stroke-dasharray")&&"none"!=this.group.subTag2.getAttribute("stroke-dasharray")&&this.group.subTag2.setAttribute("stroke-dasharray",this.get("strokeDasharray")),this.group.subTag2.setAttribute("stroke",this.get("stroke")),this.group.subTag2.setAttribute("fill",this.get("fill")),this.group.subTag2.setAttribute("fill-opacity",this.get("fillOpacity")),this.group.subTag2.setAttribute("stroke-opacity",this.get("strokeOpacity"))),null!=this.group.subTag3&&(this.group.subTag3.setAttribute("stroke-width",this.get("strokeWidth")),"line"!=this.tagName&&"flowline"!=this.tagName&&"freeline"!=this.tagName&&null!=this.group.subTag3.getAttribute("stroke-dasharray")&&"none"!=this.group.subTag3.getAttribute("stroke-dasharray")&&this.group.subTag3.setAttribute("stroke-dasharray",this.get("strokeDasharray")),this.group.subTag3.setAttribute("stroke",this.get("stroke")),this.group.subTag3.setAttribute("fill",this.get("fill")),this.group.subTag3.setAttribute("fill-opacity",this.get("fillOpacity")),this.group.subTag3.setAttribute("stroke-opacity",this.get("strokeOpacity"))),null!=this.group.subTag4&&(this.group.subTag4.setAttribute("stroke-width",this.get("strokeWidth")),"line"!=this.tagName&&"flowline"!=this.tagName&&"freeline"!=this.tagName&&null!=this.group.subTag4.getAttribute("stroke-dasharray")&&"none"!=this.group.subTag4.getAttribute("stroke-dasharray")&&this.group.subTag4.setAttribute("stroke-dasharray",this.get("strokeDasharray")),this.group.subTag4.setAttribute("stroke",this.get("stroke")),this.group.subTag4.setAttribute("fill",this.get("fill")),this.group.subTag4.setAttribute("fill-opacity",this.get("fillOpacity")),this.group.subTag4.setAttribute("stroke-opacity",this.get("strokeOpacity"))),null!=this.group.subTag5&&(this.group.subTag5.setAttribute("stroke-width",this.get("strokeWidth")),"line"!=this.tagName&&"flowline"!=this.tagName&&"freeline"!=this.tagName&&null!=this.group.subTag5.getAttribute("stroke-dasharray")&&"none"!=this.group.subTag5.getAttribute("stroke-dasharray")&&this.group.subTag5.setAttribute("stroke-dasharray",this.get("strokeDasharray")),this.group.subTag5.setAttribute("stroke",this.get("stroke")),this.group.subTag5.setAttribute("fill",this.get("fill")),this.group.subTag5.setAttribute("fill-opacity",this.get("fillOpacity")),this.group.subTag5.setAttribute("stroke-opacity",this.get("strokeOpacity"))),null!=this.group.subTag6&&(this.group.subTag6.setAttribute("stroke-width",this.get("strokeWidth")),"line"!=this.tagName&&"flowline"!=this.tagName&&"freeline"!=this.tagName&&null!=this.group.subTag6.getAttribute("stroke-dasharray")&&"none"!=this.group.subTag6.getAttribute("stroke-dasharray")&&this.group.subTag6.setAttribute("stroke-dasharray",this.get("strokeDasharray")),this.group.subTag6.setAttribute("stroke",this.get("stroke")),this.group.subTag6.setAttribute("fill",this.get("fill")),this.group.subTag6.setAttribute("fill-opacity",this.get("fillOpacity")),this.group.subTag6.setAttribute("stroke-opacity",this.get("strokeOpacity"))),null!=this.group.subTag11&&(this.group.subTag11.setAttribute("stroke-width",this.get("strokeWidth")),"line"!=this.tagName&&"flowline"!=this.tagName&&"freeline"!=this.tagName&&this.group.subTag11.setAttribute("stroke-dasharray",this.get("strokeDasharray")),this.group.subTag11.setAttribute("stroke",this.get("stroke")),this.group.subTag11.setAttribute("stroke-opacity",this.get("strokeOpacity"))),null!=this.group.subTag12&&(this.group.subTag12.setAttribute("stroke-width",this.get("strokeWidth")),"line"!=this.tagName&&"flowline"!=this.tagName&&"freeline"!=this.tagName&&this.group.subTag12.setAttribute("stroke-dasharray",this.get("strokeDasharray")),this.group.subTag12.setAttribute("stroke",this.get("stroke")),this.group.subTag12.setAttribute("stroke-opacity",this.get("strokeOpacity"))),null!=this.group.subTag13&&(this.group.subTag13.setAttribute("stroke-width",this.get("strokeWidth")),"line"!=this.tagName&&"flowline"!=this.tagName&&"freeline"!=this.tagName&&this.group.subTag13.setAttribute("stroke-dasharray",this.get("strokeDasharray")),this.group.subTag13.setAttribute("stroke",this.get("stroke")),this.group.subTag13.setAttribute("stroke-opacity",this.get("strokeOpacity"))),null!=this.group.subTag14&&(this.group.subTag14.setAttribute("stroke-width",this.get("strokeWidth")),"line"!=this.tagName&&"flowline"!=this.tagName&&"freeline"!=this.tagName&&this.group.subTag14.setAttribute("stroke-dasharray",this.get("strokeDasharray")),this.group.subTag14.setAttribute("stroke",this.get("stroke")),this.group.subTag14.setAttribute("stroke-opacity",this.get("strokeOpacity"))),null!=this.group.subTag15&&(this.group.subTag15.setAttribute("stroke-width",this.get("strokeWidth")),"line"!=this.tagName&&"flowline"!=this.tagName&&"freeline"!=this.tagName&&this.group.subTag15.setAttribute("stroke-dasharray",this.get("strokeDasharray")),this.group.subTag15.setAttribute("stroke",this.get("stroke")),this.group.subTag15.setAttribute("stroke-opacity",this.get("strokeOpacity"))),null!=this.group.subTag16&&(this.group.subTag16.setAttribute("stroke-width",this.get("strokeWidth")),"line"!=this.tagName&&"flowline"!=this.tagName&&"freeline"!=this.tagName&&this.group.subTag16.setAttribute("stroke-dasharray",this.get("strokeDasharray")),this.group.subTag16.setAttribute("stroke",this.get("stroke")),this.group.subTag16.setAttribute("stroke-opacity",this.get("strokeOpacity"))),z.resizePointTo(0,0,0))},z.draw=function(t){if(null==z.get("draw")||0!=z.get("draw")){if(0==z.sed.editMode&&null!=z.options.editOnly&&1==z.options.editOnly){z.group.setAttribute("visibility","hidden");for(var e=0;e<z.group.children.length;e++)z.group.children[e].setAttribute("visibility","hidden");return!0}var o,s;if(null!=this.options.distance&&1==this.options.distance)if("line"==this.tagName?(o=(this.options.x1+this.options.x2)/2,s=(this.options.y1+this.options.y2)/2,"left"==this.options.distanceTextAlignHor&&(o=0),"top"==this.options.distanceTextAlignVer&&(s=0)):"rulerHor"==this.tagName?(o=0,s=-.5*this.options.height):"rulerVer"==this.tagName&&(o=-.5*this.options.width,s=0),null!=this.group.textDistance)if("layerDistance"==this.parentLayer.options.figure){"left"==this.options.distanceTextAlignHor?(this.group.textDistance.setAttribute("x",o-5),this.group.textDistance.setAttribute("text-anchor","end")):"right"==this.options.distanceTextAlignHor?(this.group.textDistance.setAttribute("x",o+5),this.group.textDistance.setAttribute("text-anchor","start")):(this.group.textDistance.setAttribute("x",o),this.group.textDistance.setAttribute("text-anchor","middle")),"top"==this.options.distanceTextAlignVer?(this.group.textDistance.setAttribute("y",s-10),this.group.textDistance.setAttribute("alignment-baseline","baseline")):"bottom"==this.options.distanceTextAlignVer?(this.group.textDistance.setAttribute("y",s+15),this.group.textDistance.setAttribute("alignment-baseline","hanging")):(this.group.textDistance.setAttribute("y",s+10),this.group.textDistance.setAttribute("alignment-baseline","middle"));var i=null;"line"==this.tagName?(i=Math.round(Math.sqrt((this.options.x1-this.options.x2)*(this.options.x1-this.options.x2)+(this.options.y1-this.options.y2)*(this.options.y1-this.options.y2))/this.parentLayer.options.distancePixel*100)/100,this.group.textDistance.textContent=i+" "+this.parentLayer.options.distanceUnit):"rulerHor"==this.tagName?this.group.textDistance.textContent=this.options.distanceX:"rulerVer"==this.tagName&&(this.group.textDistance.textContent=this.options.distanceY)}else this.group.textDistance.textContent="";if("svg"==this.tagName&&(z.group.tag.svg.setAttribute("x",z.get("width")/-2),z.group.tag.svg.setAttribute("y",z.get("height")/-2),z.group.tag.svg.setAttribute("width",z.get("width")),z.group.tag.svg.setAttribute("height",z.get("height"))),"mapContainer"==this.tagName&&null!=z.group.tagSvg&&(z.group.tagSvg.setAttribute("x",z.get("width")/-2),z.group.tagSvg.setAttribute("y",z.get("height")/-2),z.group.tagSvg.setAttribute("width",z.get("width")),z.group.tagSvg.setAttribute("height",z.get("height"))),z.options.groupLeft=z.get("x"),z.options.groupRight=z.get("x"),z.options.groupTop=z.get("y"),z.options.groupBottom=z.get("y"),1==z.options.layer3d)this.setGroupArea(),this.group.tag.setAttribute("visibility","visible"),z.drawImage(),z.drawDots(),z.group.setAttribute("transform","translate("+this.get("x")+","+this.get("y")+") rotate("+this.get("rotate")+")");else if("flowline3d"==z.tagName)sedLib.drawFlowline3d(z);else if("text3d"==z.tagName)this.group.tag.setAttribute("x",this.get("width")/-2),this.group.tag.setAttribute("y",this.get("height")/-2),this.group.tag.setAttribute("opacity",0),this.group.tag.setAttribute("width",this.get("width")),this.group.tag.setAttribute("height",this.get("height")),this.group.tagText.setAttribute("x",this.get("width")/-2),this.group.tagText.setAttribute("y",this.get("height")/-2),this.group.tagText.setAttribute("width",this.get("width")),this.group.tagText.setAttribute("height",this.get("height")),this.group.tagText.setAttribute("opacity",this.get("opacity")),z.drawText(),z.drawDots(),0==z.get("rotate3D")?z.group.setAttribute("transform","translate("+this.get("x")+","+(this.get("y")+0)+") rotate(33.3) skewX(33.3)"):1==z.get("rotate3D")?z.group.setAttribute("transform","translate("+this.get("x")+","+(this.get("y")+0)+") rotate(33.3) skewX(-21.3)"):2==z.get("rotate3D")?z.group.setAttribute("transform","translate("+this.get("x")+","+(this.get("y")+0)+") rotate(-33.3) skewX(-33.3)"):3==z.get("rotate3D")&&z.group.setAttribute("transform","translate("+this.get("x")+","+(this.get("y")+0)+") rotate(-33.3) skewX(21.3)");else if("freeline"==z.tagName)sedLib.drawFreeline(z),z.drawDots();else if("flowline"==z.tagName)sedLib.drawFlowline(z),z.drawDots();else if("selectedRectangle"==z.tagName)1==z.sed.svg.groupSelectMode&&(this.setGroupArea(),this.group.tag.setAttribute("x",Math.abs(this.get("width"))/2*-1),this.group.tag.setAttribute("y",Math.abs(this.get("height"))/2*-1),this.group.tag.setAttribute("width",Math.abs(this.get("width"))),this.group.tag.setAttribute("height",Math.abs(this.get("height"))),z.drawDots(),z.group.setAttribute("transform","translate("+this.get("x")+","+this.get("y")+") rotate("+this.get("rotate")+")"));else if("userpath"==z.tagName)this.group.tag.setAttribute("d",this.get("d"));else if("line"==z.tagName){this.group.tag.setAttribute("x1",this.get("x1")),this.group.tag.setAttribute("y1",this.get("y1")),this.group.tag.setAttribute("x2",this.get("x2")),this.group.tag.setAttribute("y2",this.get("y2")),z.drawDots();var n=z.calcRotateByPos(this.get("x1"),this.get("y1"),this.get("x2"),this.get("y2")),a=sedLib.getRadianToAngle(n);sedLib.drawArrows(z,a,this.get("x1"),this.get("y1"),this.get("x2"),this.get("y2")),z.drawDots()}else if("seqLine"==z.tagName){this.group.tag.setAttribute("x1",this.get("x1")),this.group.tag.setAttribute("y1",this.get("y1")),this.group.tag.setAttribute("x2",this.get("x2")),this.group.tag.setAttribute("y2",this.get("y2")),z.drawDots();n=z.calcRotateByPos(this.get("x1"),this.get("y1"),this.get("x2"),this.get("y2")),a=sedLib.getRadianToAngle(n);"line"==this.options.arrowType1&&(z.group.subTag1.setAttribute("x1",0),z.group.subTag1.setAttribute("y1",0),z.group.subTag1.setAttribute("x2",-10),z.group.subTag1.setAttribute("y2",10),z.group.subTag2.setAttribute("x1",0),z.group.subTag2.setAttribute("y1",0),z.group.subTag2.setAttribute("x2",10),z.group.subTag2.setAttribute("y2",10),z.group.subTag1.setAttribute("transform","translate("+this.get("x1")+","+this.get("y1")+") rotate("+(a+180)+")"),z.group.subTag2.setAttribute("transform","translate("+this.get("x1")+","+this.get("y1")+") rotate("+(a+180)+")")),"line"==this.options.arrowType2&&(z.group.subTag11.setAttribute("x1",0),z.group.subTag11.setAttribute("y1",0),z.group.subTag11.setAttribute("x2",-10),z.group.subTag11.setAttribute("y2",10),z.group.subTag12.setAttribute("x1",0),z.group.subTag12.setAttribute("y1",0),z.group.subTag12.setAttribute("x2",10),z.group.subTag12.setAttribute("y2",10),z.group.subTag11.setAttribute("transform","translate("+this.get("x2")+","+this.get("y2")+") rotate("+a+")"),z.group.subTag12.setAttribute("transform","translate("+this.get("x2")+","+this.get("y2")+") rotate("+a+")")),"triangle"==this.options.arrowType1&&(z.group.subTriangleTag1.setAttribute("d","M"+Number(0)+" "+Number(0)+" L"+Number(-10)+" "+Number(10)+" L"+Number(10)+" "+Number(10)+" Z"),z.group.subTriangleTag1.setAttribute("transform","translate("+this.get("x1")+","+this.get("y1")+") rotate("+a+"180)")),"triangle"==this.options.arrowType2&&(z.group.subTriangleTag11.setAttribute("d","M"+Number(0)+" "+Number(0)+" L"+Number(-10)+" "+Number(10)+" L"+Number(10)+" "+Number(10)+" Z"),z.group.subTriangleTag11.setAttribute("transform","translate("+this.get("x2")+","+this.get("y2")+") rotate("+a+")"))}else if(1==z.options.baseSp){this.setGroupArea(),this.group.tag.setAttribute("visibility","visible"),this.group.tag.setAttribute("x",this.get("width")/2*-1),this.group.tag.setAttribute("y",this.get("height")/2*-1),this.group.tag.setAttribute("width",this.get("width")),this.group.tag.setAttribute("height",this.get("height")),"circle"!=this.tagName&&"connector"!=this.tagName||this.group.tag.setAttribute("r",this.get("width")/2),null!=this.group.rotateLine&&(this.group.rotateLine.setAttribute("x1",this.get("rotateDotPos").x),this.group.rotateLine.setAttribute("y1",this.get("rotateDotPos").y),this.group.rotateLine.setAttribute("x2",this.get("dotsPos")[0].x),this.group.rotateLine.setAttribute("y2",this.get("dotsPos")[0].y)),null!=this.group.rotateDot&&(z.group.rotateDot.setAttribute("cx",this.get("rotateDotPos").x),z.group.rotateDot.setAttribute("cy",this.get("rotateDotPos").y)),z.drawImage(),z.drawDots();var r=0,g=0;null!=this.options.baseAlign&&null!=this.options.baseAlign&&"leftbottom"==this.options.baseAlign&&(r=this.options.width/-2,g=this.options.height/2);if(z.parentLayer,null!=z.parentLayer&&"layerMap"==z.parentLayer.options.figure){var l=z.options.baseMapScale-z.parentLayer.options.mapScale;Math.pow(2,l)}z.group.setAttribute("transform","translate("+(this.get("x")+r)+","+(this.get("y")+g)+") rotate("+this.get("rotate")+")"),"basicPathDot"==z.tagName&&z.drawDots()}}},z.set=function(t,e){z.options[t]=e},z.get=function(t){return z.options[t]},z.setHidden=function(t){null!=z.get("draw")&&0==z.get("draw")||(z.options.visibility=t,z.group.tag.setAttribute("visibility",t))},z.setHeight=function(t){null!=z.get("draw")&&0==z.get("draw")||(z.options.height=t,null!=z.options.baseMapHeight&&(z.options.baseMapHeight=t),"number"==typeof t&&(t+="px"),z.group.tag.setAttribute("height",t),z.resizePointTo(0,0,0))},z.setWidth=function(t){null!=z.get("draw")&&0==z.get("draw")||(z.options.width=t,null!=z.options.baseMapWidth&&(z.options.baseMapWidth=t),"number"==typeof t&&(t+="px"),z.group.tag.setAttribute("width",t),z.resizePointTo(0,0,0))},z.setFill=function(t){z.set("fill",t),z.group.tag.style.fill=t},z.setStroke=function(t){z.set("storke",t),z.group.tag.style.stroke=t},z.setStrokeWidth=function(t){z.set("strok-width",t),z.group.tag.style["stroke-width"]=t},z.setStrokeLineCap=function(t){z.set("strokeLineCap",t),z.group.tag.style["stroke-linecap"]=t},z.setSimpleText=function(t){z.set("simpleText",t)},z.setSimpleTextAlign=function(t){z.set("simpleTextAlign",t)},z.setSimpleTextPadding=function(t){z.set("simpleTextPadding",t)},z.setText=function(t){z.set("text",t),z.clientRects=z.group.tagText.getClientRects(),sedLib.appendTspan(z,z.group.tagText,z.options.text),z.setTextVAlign(z.options.textVAlign),z.drawText()},z.getText=function(){return z.options.text},z.setFontSize=function(t){z.set("fontSize",t),z.drawText()},z.setFontColor=function(t){z.set("fontColor",t),z.drawText()},z.setTextVAlign=function(t){z.set("textVAlign",t),z.clientRects=z.group.tagText.getClientRects(),z.drawText()},z.setPosLatLng=function(t,e){sedLib.calcLatLngToXY(z,t,e),z.draw(100)},z.setVisibility=function(t){z.group.tag.style.visibility="hidden",null!=z.group.img&&(z.group.img.style.visibility="hidden"),null!=z.group.tagText&&(z.group.tagText.style.visibility="hidden")},z.setImage=function(t){z.options.srcIn=!0,z.options.src=t;var e=sedLib.createTagImg(z.options);z.group.appendChild(e),z.group.img=e},z.setRef=function(t){z.options.fgRef=t,z.group.tag.setAttribute("fgRef",t)},z.getState=function(){return z.options.state},z.setTooltip=function(t){z.options.tooltip=t},z.getTooltip=function(){return z.options.tooltip},z.select=function(){null!=z.sed.svg.selectedFg&&z.sed.svg.selectedFg.hideDot(),(z.sed.svg.selectedFg=z).showDot()},z.addTooltipArea=function(t){},z.setFolder=function(t){z.options.folder=t},z.addChild=function(t,e,o){if(1==z.options.basic3d){for(var s=z.getHeight3D(),i=z.group.querySelectorAll("[baseFg=true]"),n=0;n<i.length;n++){if((a=i[n].parentNode.fg)!=z)if(1==a.options.basic3d)s+=a.getHeight3D();else s+=(a=i[n].parentNode.fg).get("height")}null!=e&&null!=o?(t.set("x",e),t.set("y",o)):(t.set("x",0),t.set("y",-1*s)),t.draw(101)}else{for(s=z.get("height"),i=z.group.querySelectorAll("[baseFg=true]"),n=0;n<i.length;n++){var a;if((a=i[n].parentNode.fg)!=z)if(1==a.options.basic3d)s+=a.getHeight3D();else s+=(a=i[n].parentNode.fg).get("height")}null!=e&&null!=o?(t.set("x",e),t.set("y",o)):(t.set("x",0),t.set("y",s)),t.draw(102)}if(t.parentGroup=z,t.set("parentGroup",z.get("figureId")),z.group.appendChild(t.group),null!=z.options.basicData&&null!=z.options.basicData)for(var r=0;r<z.options.basicData.objects.length;r++)null!=z.options.basicData.objects[r].groupFront&&1==z.options.basicData.objects[r].groupFront&&z.group.appendChild(z.group.subGroup[r])},z.refresh=function(t){setTagsShape(z,z.options,!1,2)},z.moveXY=function(t,e){null!=z.get("draw")&&0==z.get("draw")||("seqLine"==z.tagName||"line"==z.tagName||"flowline"==z.tagName||"flowline3d"==z.tagName||"freeline"==z.tagName||(z.set("x",t),z.set("y",e)),z.moveJoinDots(),z.calcWidthHeight(),z.draw(103),setTimeout(function(){null!=z.sed&&null!=z.sed&&z.sed.setProperties(z)},100))},z.hideDot=function(){if(null==z.get("draw")||0!=z.get("draw")){if("flowline"==z.tagName||"flowline3d"==z.tagName)for(var t=0;t<2;t++)z.group.dots[t].setAttribute("visibility","hidden");else if("freeline"==z.tagName||"basicFreeDot"==z.tagName)for(t=0;t<z.group.dots.length;t++)z.group.dots[t].setAttribute("visibility","hidden");else if("line"==z.tagName||"seqLine"==z.tagName)for(t=0;t<2;t++)z.group.dots[t].setAttribute("visibility","hidden");else if("selectedRectangle"==z.tagName)for(t=0;t<z.group.dots.length;t++)z.group.dots[t].setAttribute("visibility","hidden");else{if(1==z.options.baseSp&&null!=z.group.joinDots)for(t=0;t<z.group.joinDots.length;t++)z.group.joinDots[t].setAttribute("visibility","hidden");if(null!=z.group.dots)for(t=0;t<z.group.dots.length;t++)z.group.dots[t].setAttribute("visibility","hidden");null!=z.group.rotateDot&&null!=z.group.rotateDot&&z.group.rotateDot.setAttribute("visibility","hidden"),null!=z.group.rotateLine&&null!=z.group.rotateLine&&z.group.rotateLine.setAttribute("visibility","hidden")}"groupRect"==z.tagName&&z.group.subTagGroupTitle.setAttribute("visibility","hidden"),"flowline"==z.tagName||"flowline3d"==z.tagName?(z.group.lineDots[0].setAttribute("visibility","hidden"),z.group.lineDots[1].setAttribute("visibility","hidden"),z.group.lineDots[2].setAttribute("visibility","hidden")):z.tagName,1==z.options.diagram&&null!=z.hideButtons&&z.hideButtons()}},z.showJoinDot=function(){if(!(null!=z.get("draw")&&0==z.get("draw")||0==z.sed.editMode&&"move"!=z.sed.editType))for(var t=0;t<z.group.joinDots.length;t++)z.group.joinDots[t].setAttribute("visibility","visible"),z.group.appendChild(z.group.joinDots[t])},z.hideJoinDot=function(){if(!(null!=z.get("draw")&&0==z.get("draw")||0==z.sed.editMode&&"move"!=z.sed.editType))for(var t=0;t<z.group.joinDots.length;t++)z.group.joinDots[t].setAttribute("visibility","hidden")},z.showDot=function(){if(!(null!=z.get("draw")&&0==z.get("draw")||0==z.sed.editMode&&"move"!=z.sed.editType||"map"==z.tagName)){if("line"==z.tagName||"flowline"==z.tagName||"flowline3d"==z.tagName||"seqLine"==z.tagName)for(var t=0;t<2;t++)z.group.dots[t].setAttribute("visibility","visible"),z.group.appendChild(z.group.dots[t]);else if("freeline"==z.tagName||"basicPathDot"==z.tagName)for(t=0;t<z.group.dots.length;t++)z.group.dots[t].setAttribute("visibility","visible"),z.group.appendChild(z.group.dots[t]);else if("selectedRectangle"==z.tagName)for(t=0;t<z.group.dots.length;t++)z.group.dots[t].setAttribute("visibility","visible"),z.group.appendChild(z.group.dots[t]);else{for(t=0;t<z.group.dots.length;t++)1==z.options.sameWh||1==z.options.dot4Way?t%2==0?(z.group.dots[t].setAttribute("visibility","visible"),z.group.appendChild(z.group.dots[t])):z.group.dots[t].setAttribute("visibility","hidden"):(z.group.dots[t].setAttribute("visibility","visible"),z.group.appendChild(z.group.dots[t]));null!=z.get("rotatable")&&0==z.get("rotatable")?(null!=z.group.rotateDot&&z.group.rotateDot.setAttribute("visibility","hidden"),null!=z.group.rotateLine&&z.group.rotateLine.setAttribute("visibility","hidden")):(null!=z.group.rotateDot&&z.group.rotateDot.setAttribute("visibility","visible"),null!=z.group.rotateLine&&z.group.rotateLine.setAttribute("visibility","visible"))}"groupRect"==z.tagName&&z.group.subTagGroupTitle.setAttribute("visibility","visible"),"flowline"==z.tagName&&sedLib.drawFlowline(z),"fleeline"==z.tagName&&sedLib.drawFreeline(z),1==z.options.diagram&&z.showButtons()}},z.movePointXY=function(t,e,o){if(null==z.get("draw")||0!=z.get("draw")){if("seqLine"==z.tagName){if(0==t){Number(z.get("x1"));z.set("x1",e)}else if(1==t){Number(z.get("x2"));z.set("x2",e)}}else if("line"==z.tagName||"flowline"==z.tagName||"flowline3d"==z.tagName){if(0==t){Number(z.get("x1")),Number(z.get("y1"));z.set("x1",e),z.set("y1",o)}else if(1==t){Number(z.get("x2")),Number(z.get("y2"));z.set("x2",e),z.set("y2",o)}}else"freeline"!=z.tagName&&"basicPathDot"!=z.tagName||(z.group.dotsPos[t].x=e,z.group.dotsPos[t].y=o);z.draw(104)}},z.resizePointTo=function(t,e,o){if("true"==z.options.sameWh?z.options.sameWh=!0:"false"==z.options.sameWh&&(z.options.sameWh=!1),null==z.get("draw")||0!=z.get("draw")){var s=Number(this.get("width")),i=Number(this.get("height")),n=Number(z.get("x")),a=Number(z.get("y")),r=-1*z.rotate,g=Number(e*Math.cos(r*Math.PI/180))+-1*Number(o*Math.sin(r*Math.PI/180)),l=1*Number(e*Math.sin(r*Math.PI/180))+Number(o*Math.cos(r*Math.PI/180)),d=0,u=0;if(e=g,o=l,"basicPathDot"==this.tagName);else if("selectedRectangle"==this.tagName||1==z.options.baseSp){if(0==t?(z.set("height",i-o),1==z.options.sameWh&&z.set("width",z.options.height*s/i),i-o,d=Number(0*Math.cos(z.rotate*Math.PI/180))+-1*Number(.5*o*Math.sin(z.rotate*Math.PI/180)),u=Number(0*Math.sin(z.rotate*Math.PI/180))+Number(.5*o*Math.cos(z.rotate*Math.PI/180)),z.set("x",n+d),z.set("y",a+u)):1==t?(z.set("height",i-o),z.set("width",s+e),d=Number(.5*e*Math.cos(z.rotate*Math.PI/180))+-1*Number(.5*o*Math.sin(z.rotate*Math.PI/180)),u=Number(.5*e*Math.sin(z.rotate*Math.PI/180))+Number(.5*o*Math.cos(z.rotate*Math.PI/180)),z.set("x",n+d),z.set("y",a+u)):2==t?(z.set("width",s+e),1==z.options.sameWh&&z.set("height",z.options.width*i/s),d=Number(.5*e*Math.cos(z.rotate*Math.PI/180))+-1*Number(0*o*Math.sin(z.rotate*Math.PI/180)),u=Number(.5*e*Math.sin(z.rotate*Math.PI/180))+Number(0*o*Math.cos(z.rotate*Math.PI/180)),z.set("x",n+d),z.set("y",a+u)):3==t?(z.set("width",s+e),z.set("height",i+o),d=Number(.5*e*Math.cos(z.rotate*Math.PI/180))+-1*Number(.5*o*Math.sin(z.rotate*Math.PI/180)),u=Number(.5*e*Math.sin(z.rotate*Math.PI/180))+Number(.5*o*Math.cos(z.rotate*Math.PI/180)),z.set("x",n+d),z.set("y",a+u)):4==t?(z.set("height",i+o),1==z.options.sameWh&&z.set("width",z.options.height*s/i),d=Number(0*e*Math.cos(z.rotate*Math.PI/180))+-1*Number(.5*o*Math.sin(z.rotate*Math.PI/180)),u=Number(0*e*Math.sin(z.rotate*Math.PI/180))+Number(.5*o*Math.cos(z.rotate*Math.PI/180)),z.set("x",n+d),z.set("y",a+u)):5==t?(z.set("width",s-e),z.set("height",i+o),d=Number(.5*e*Math.cos(z.rotate*Math.PI/180))+-1*Number(.5*o*Math.sin(z.rotate*Math.PI/180)),u=Number(.5*e*Math.sin(z.rotate*Math.PI/180))+Number(.5*o*Math.cos(z.rotate*Math.PI/180)),z.set("x",n+d),z.set("y",a+u)):6==t?(z.set("width",s-e),1==z.options.sameWh&&z.set("height",z.options.width*i/s),d=Number(.5*e*Math.cos(z.rotate*Math.PI/180))+-1*Number(0*o*Math.sin(z.rotate*Math.PI/180)),u=Number(.5*e*Math.sin(z.rotate*Math.PI/180))+Number(0*o*Math.cos(z.rotate*Math.PI/180)),z.set("x",n+d),z.set("y",a+u)):7==t&&(z.set("width",s-e),z.set("height",i-o),d=Number(.5*e*Math.cos(z.rotate*Math.PI/180))+-1*Number(.5*o*Math.sin(z.rotate*Math.PI/180)),u=Number(.5*e*Math.sin(z.rotate*Math.PI/180))+Number(.5*o*Math.cos(z.rotate*Math.PI/180)),z.set("x",n+d),z.set("y",a+u)),"syncmessage"==z.tagName||"syncmessagedot"==z.tagName||"asyncmessage"==z.tagName||"asyncmessagedot"==z.tagName||"selectedRectangle"!=this.tagName&&(z.get("width")<0&&z.set("width",1),z.get("height")<0&&z.set("height",1)),"layer3d"==z.tagName);else if("basic3d"==z.tagName){var p=z.options.width,c=z.options.height;z.options.dotsPos[0].x=z.options.sizeDotsPosData[0].x*p/100,z.options.dotsPos[2].x=z.options.sizeDotsPosData[1].x*p/100,z.options.dotsPos[4].x=z.options.sizeDotsPosData[2].x*p/100,z.options.dotsPos[6].x=z.options.sizeDotsPosData[3].x*p/100,z.options.dotsPos[0].y=z.options.sizeDotsPosData[0].y*c/100,z.options.dotsPos[2].y=z.options.sizeDotsPosData[1].y*c/100,z.options.dotsPos[4].y=z.options.sizeDotsPosData[2].y*c/100,z.options.dotsPos[6].y=z.options.sizeDotsPosData[3].y*c/100}else z.options.dotsPos[0]={x:z.options.width/2*0,y:z.options.height/2*-1},z.options.dotsPos[1]={x:z.options.width/2*1,y:z.options.height/2*-1},z.options.dotsPos[2]={x:z.options.width/2*1,y:z.options.height/2*0},z.options.dotsPos[3]={x:z.options.width/2*1,y:z.options.height/2*1},z.options.dotsPos[4]={x:z.options.width/2*0,y:z.options.height/2*1},z.options.dotsPos[5]={x:z.options.width/2*-1,y:z.options.height/2*1},z.options.dotsPos[6]={x:z.options.width/2*-1,y:z.options.height/2*0},z.options.dotsPos[7]={x:z.options.width/2*-1,y:z.options.height/2*-1};z.options.rotateDotPos={x:z.options.width/2*0,y:z.options.height/2*-1-30},null!=z.options.src&&null!=z.options.src&&""!=z.options.src&&1!=z.get("d3")&&(z.group.img.setAttribute("x",z.get("width")/-2+"px"),z.group.img.setAttribute("y",z.get("height")/-2+"px"),z.group.img.setAttribute("width",z.get("width")+"px"),z.group.img.setAttribute("height",z.get("height")+"px"),z.group.img.setAttribute("viewBox","0 0 "+z.get("width")+" "+z.get("height"))),setTagsShape(z,z.options,!1,3),setJoinDotsPos(z)}else if(0==t){if(i-o<=0)return;z.set("height",i-o),z.set("y",a+o)}else if(1==t){if(s+e<=0)return;z.set("width",s+e)}else if(2==t){if(i+o<=0)return;z.set("height",i+o)}else if(3==t){if(s-e<=0)return;z.set("width",s-e),z.set("x",n+e)}if("selectedRectangle"==z.tagName);else if("line"!=z.tagName&&"flowline"!=z.tagName&&"freeline"!=z.tagName&&"basicPathDot"!=z.tagName&&"flowline3d"!=z.tagName&&"seqLine"!=z.tagName&&null!=z.group.joinDots)for(var h=0;h<z.group.joinDots.length;h++)if(0<z.group.joinDots[h].connected.length)for(var b=0;b<z.group.joinDots[h].connected.length;b++)if(null!=z.group.joinDots[h].connectedIndex[b]){var y=z.group.joinDots[h].connectedIndex[b];0==h?z.group.joinDots[h].connected[b].movePointXY(y,Number(z.get("x"))+Number(z.get("width"))/2,Number(z.get("y"))):1==h?z.group.joinDots[h].connected[b].movePointXY(y,Number(z.get("x"))+Number(z.get("width")),Number(z.get("y"))+Number(z.get("height"))/2):2==h?z.group.joinDots[h].connected[b].movePointXY(y,Number(z.get("x"))+Number(z.get("width"))/2,Number(z.get("y"))+Number(z.get("height"))):3==h&&z.group.joinDots[h].connected[b].movePointXY(y,Number(z.get("x")),Number(z.get("y"))+Number(z.get("height"))/2)}z.rotateFg(z.options.rotate,!1),z.moveJoinDots(),z.draw(105),null!=z.group.tagText&&(z.group.tagText.setAttribute("x",-.5*z.get("width")),z.group.tagText.setAttribute("y",-.5*z.get("height")),z.group.tagText.setAttribute("width",z.get("width")),z.group.tagText.setAttribute("height",z.get("height"))),z.drawText(),null!=z.parentLayer&&z.parentLayer.options.figure}},z.movePointTo=function(t,e,o){if(null==z.get("draw")||0!=z.get("draw")){if("seqLine"==z.tagName){if(0==t){var s=Number(z.get("x1")),i=Number(z.get("y1"));z.set("x1",s+e),z.options.dotsPos[0]={x:s+e,y:i},z.options.joinDotsPos[0]={x:s+e,y:i}}else if(1==t){var n=Number(z.get("x2")),a=Number(z.get("y2"));z.set("x2",n+e),z.options.dotsPos[1]={x:n+e,y:a},z.options.joinDotsPos[1]={x:n+e,y:a}}}else if("line"==z.tagName||"flowline"==z.tagName||"flowline3d"==z.tagName){if(0==t){s=Number(z.get("x1")),i=Number(z.get("y1"));z.set("x1",s+e),z.set("y1",i+o),z.options.dotsPos[0]={x:s+e,y:i+o},z.options.joinDotsPos[0]={x:s+e,y:i+o}}else if(1==t){n=Number(z.get("x2")),a=Number(z.get("y2"));z.set("x2",n+e),z.set("y2",a+o),z.options.dotsPos[1]={x:n+e,y:a+o},z.options.joinDotsPos[1]={x:n+e,y:a+o}}}else if("freeline"==z.tagName)z.options.dotsPos[t].x=Number(z.options.dotsPos[t].x)+e,z.options.dotsPos[t].y=Number(z.options.dotsPos[t].y)+o;else if("basicPathDot"==z.tagName){var r=z.options.width,g=z.options.height;0==r&&(r=1),0==g&&(g=1),z.options.dotsPos[t].x=Number(z.options.dotsPos[t].x)+100*e/z.options.width,z.options.dotsPos[t].y=Number(z.options.dotsPos[t].y)+100*o/z.options.height}z.moveJoinDots(),z.draw(107)}},z.moveLineTo=function(t,e,o){if(null==z.get("draw")||0!=z.get("draw")){if("flowline"==z.tagName)z.options.lineMoveMode="M","H"==z.options.lineMoveDir[t]?(z.options.lineMovePos[t].x=z.options.lineMovePos[t].x+e,z.options.lineMovePos[t+1].x=z.options.lineMovePos[t+1].x+e):"V"==z.options.lineMoveDir[t]&&(z.options.lineMovePos[t].y=z.options.lineMovePos[t].y+o,z.options.lineMovePos[t+1].y=z.options.lineMovePos[t+1].y+o);else if("freeline"==z.tagName||"basicPathDot"==z.tagName);else if("flowline3d"==z.tagName){Number(e*Math.cos(56.4*Math.PI/180)),Number(o*Math.sin(56.4*Math.PI/180)),Number(e*Math.sin(56.4*Math.PI/180)),Number(o*Math.cos(56.4*Math.PI/180)),Number(e*Math.cos(33.6*Math.PI/180)),Number(o*Math.sin(33.6*Math.PI/180)),Number(e*Math.sin(33.6*Math.PI/180)),Number(o*Math.cos(33.6*Math.PI/180));z.options.lineMoveMode="M","V"==z.options.lineMoveDir[t]?(z.options.lineMovePos[t].x=z.options.lineMovePos[t].x+e,z.options.lineMovePos[t].y=z.options.lineMovePos[t].y+6*e/9,z.options.lineMovePos[t+1].x=z.options.lineMovePos[t+1].x+e,z.options.lineMovePos[t+1].y=z.options.lineMovePos[t+1].y+6*e/9):"H"==z.options.lineMoveDir[t]&&(z.options.lineMovePos[t].x=z.options.lineMovePos[t].x-9*o/6,z.options.lineMovePos[t].y=z.options.lineMovePos[t].y+o,z.options.lineMovePos[t+1].x=z.options.lineMovePos[t+1].x-9*o/6,z.options.lineMovePos[t+1].y=z.options.lineMovePos[t+1].y+o)}z.draw(108)}},z.drawText=function(t){if((null==z.get("draw")||0!=z.get("draw"))&&null!=z.group.tagText)if(1==z.options.d3text){null!=z.get("fontColor")&&""!=z.get("fontColor")&&z.group.tagText.setAttribute("fill",z.get("fontColor")),null!=z.get("fontSize")&&""!=z.get("fontSize")&&z.group.tagText.setAttribute("font-size",z.get("fontSize")),null!=z.get("fontFamily")&&""!=z.get("fontFamily")&&z.group.tagText.setAttribute("font-family",z.get("fontFamily"));for(var e=0,o=0;o<z.clientRects.length;o++)e+=z.clientRects[o].height;var s=s=-.5*Number(z.get("height"))/Number(z.sed.screenRatio);z.group.tagText.setAttribute("y",s),sedLib.appendTspan(z,z.group.tagText,z.options.text)}else if(null!=z.get("simpleText")&&1==z.get("simpleText")){z.group.tagText.setAttribute("y","0");var i=z.get("simpleTextPadding");null==i&&(i=0),null!=z.get("simpleTextAlign")&&"start"==z.get("simpleTextAlign")?(z.group.tagText.setAttribute("text-anchor","start"),z.group.tagText.setAttribute("alignment-baseline","middle"),z.group.tagText.setAttribute("x",z.get("width")/-2+Number(i))):null!=z.get("simpleTextAlign")&&"end"==z.get("simpleTextAlign")?(z.group.tagText.setAttribute("text-anchor","end"),z.group.tagText.setAttribute("alignment-baseline","middle"),z.group.tagText.setAttribute("x",z.get("width")/2-Number(i))):(z.group.tagText.setAttribute("text-anchor","middle"),z.group.tagText.setAttribute("alignment-baseline","middle"),z.group.tagText.setAttribute("x",0+Number(i))),null!=z.get("fontColor")&&""!=z.get("fontColor")&&z.group.tagText.setAttribute("fill",z.get("fontColor")),null!=z.get("fontSize")&&""!=z.get("fontSize")&&z.group.tagText.setAttribute("font-size",z.get("fontSize")),null!=z.get("fontFamily")&&""!=z.get("fontFamily")&&z.group.tagText.setAttribute("font-family",z.get("fontFamily")),z.group.tagText.textContent=z.get("text")}else{null!=z.get("fontColor")&&""!=z.get("fontColor")&&z.group.tagText.setAttribute("fill",z.get("fontColor")),null!=z.get("fontSize")&&""!=z.get("fontSize")&&z.group.tagText.setAttribute("font-size",z.get("fontSize")),null!=z.get("fontFamily")&&""!=z.get("fontFamily")&&z.group.tagText.setAttribute("font-family",z.get("fontFamily"));for(e=0,o=0;o<z.clientRects.length;o++)e+=z.clientRects[o].height;s=0;s="top"==z.get("textVAlign")?-.5*Number(z.get("height")):"bottom"==z.options.textVAlign?z.get("height")/2-Number(e)*Number(z.sed.screenRatio):"beneath"==z.options.textVAlign?z.get("height")/2+10:e/-2*Number(z.sed.screenRatio),z.group.tagText.setAttribute("y",s),sedLib.appendTspan(z,z.group.tagText,z.options.text)}},z.drawImage=function(){null==z.get("draw")||z.get("draw")},z.drawFilter=function(){},z.drawDots=function(){if(null==z.get("draw")||0!=z.get("draw"))if("flowline"==z.tagName||"flowline3d"==z.tagName)z.group.dots[0].setAttribute("cx",z.get("x1")),z.group.dots[0].setAttribute("cy",z.get("y1")),z.group.dots[1].setAttribute("cx",z.get("x2")),z.group.dots[1].setAttribute("cy",z.get("y2")),z.group.joinDots[0].setAttribute("cx",z.get("x1")),z.group.joinDots[0].setAttribute("cy",z.get("y1")),z.group.joinDots[1].setAttribute("cx",z.get("x2")),z.group.joinDots[1].setAttribute("cy",z.get("y2")),z.group.lineDots[0].setAttribute("cx",z.options.lineDotsPos[0].x),z.group.lineDots[0].setAttribute("cy",z.options.lineDotsPos[0].y),z.group.lineDots[1].setAttribute("cx",z.options.lineDotsPos[1].x),z.group.lineDots[1].setAttribute("cy",z.options.lineDotsPos[1].y),z.group.lineDots[2].setAttribute("cx",z.options.lineDotsPos[2].x),z.group.lineDots[2].setAttribute("cy",z.options.lineDotsPos[2].y);else if("freeline"==z.tagName)for(var t=0;t<z.options.dotsPos.length;t++)z.group.dots[t].setAttribute("cx",z.options.dotsPos[t].x),z.group.dots[t].setAttribute("cy",z.options.dotsPos[t].y);else if("basicPathDot"==z.tagName){for(t=0;t<z.options.dotsPos.length;t++)z.group.dots[t].setAttribute("cx",z.options.width/100*z.options.dotsPos[t].x),z.group.dots[t].setAttribute("cy",z.options.height/100*z.options.dotsPos[t].y);z.refresh(1)}else if("line"==z.tagName||"seqLine"==z.tagName)z.group.dots[0].setAttribute("cx",z.get("x1")),z.group.dots[0].setAttribute("cy",z.get("y1")),z.group.dots[1].setAttribute("cx",z.get("x2")),z.group.dots[1].setAttribute("cy",z.get("y2")),z.group.joinDots[0].setAttribute("cx",z.get("x1")),z.group.joinDots[0].setAttribute("cy",z.get("y1")),z.group.joinDots[1].setAttribute("cx",z.get("x2")),z.group.joinDots[1].setAttribute("cy",z.get("y2"));else if("basic3d"==z.tagName&&null!=z.parentLayer&&"layer3d"!=z.parentLayer.options.figure)width=z.options.width,height=z.options.height,z.options.dotsPos[0].x=z.options.sizeDotsPosData[0].x*width/100,z.options.dotsPos[2].x=z.options.sizeDotsPosData[1].x*width/100,z.options.dotsPos[4].x=z.options.sizeDotsPosData[2].x*width/100,z.options.dotsPos[6].x=z.options.sizeDotsPosData[3].x*width/100,z.options.dotsPos[0].y=z.options.sizeDotsPosData[0].y*height/100,z.options.dotsPos[2].y=z.options.sizeDotsPosData[1].y*height/100,z.options.dotsPos[4].y=z.options.sizeDotsPosData[2].y*height/100,z.options.dotsPos[6].y=z.options.sizeDotsPosData[3].y*height/100,z.group.dots[0].setAttribute("cx",z.options.sizeDotsPosData[0].x*width/100),z.group.dots[2].setAttribute("cx",z.options.sizeDotsPosData[1].x*width/100),z.group.dots[4].setAttribute("cx",z.options.sizeDotsPosData[2].x*width/100),z.group.dots[6].setAttribute("cx",z.options.sizeDotsPosData[3].x*width/100),z.group.dots[0].setAttribute("cy",z.options.sizeDotsPosData[0].y*height/100),z.group.dots[2].setAttribute("cy",z.options.sizeDotsPosData[1].y*height/100),z.group.dots[4].setAttribute("cy",z.options.sizeDotsPosData[2].y*height/100),z.group.dots[6].setAttribute("cy",z.options.sizeDotsPosData[3].y*height/100);else if("selectedRectangle"==z.tagName){if(null!=z.group.dots)for(t=0;t<z.group.dots.length;t++)z.group.dots[t].setAttribute("cx",z.options.dotsPos[t].x),z.group.dots[t].setAttribute("cy",z.options.dotsPos[t].y)}else if(1==z.options.baseSp){if(null!=z.group.joinDots)for(t=0;t<z.group.joinDots.length;t++)z.group.joinDots[t].setAttribute("cx",z.options.joinDotsPos[t].x),z.group.joinDots[t].setAttribute("cy",z.options.joinDotsPos[t].y);if(null!=z.group.dots)for(t=0;t<z.group.dots.length;t++)z.group.dots[t].setAttribute("cx",z.options.dotsPos[t].x),z.group.dots[t].setAttribute("cy",z.options.dotsPos[t].y)}},z.calcWidthHeight=function(){null!=z.get("draw")&&0==z.get("draw")||(0==z.rotate||180==z.rotate?(z.targetCenter=z.get("x"),z.targetLeft=z.get("x")-Number(z.get("width"))/2,z.targetRight=z.get("x")+Number(z.get("width"))/2,z.targetMiddle=z.get("y"),z.targetTop=z.get("y")-Number(z.get("height"))/2,z.targetBottom=z.get("y")+Number(z.get("height"))/2):90!=z.rotate&&270!=z.rotate||(z.targetCenter=z.get("x"),z.targetLeft=z.get("x")-Number(z.get("height"))/2,z.targetRight=z.get("x")+Number(z.get("height"))/2,z.targetMiddle=z.get("y"),z.targetTop=z.get("y")-Number(z.get("width"))/2,z.targetBottom=z.get("y")+Number(z.get("width"))/2))},z.moveTo=function(t,e){if((null==z.get("draw")||0!=z.get("draw"))&&1!=z.sed.editPopMode&&null!=z.svg.selectedFg&&1!=z.svg.selectedFg.options.fix&&1!=z.svg.selectedFg.options.mapFixPos){if(z.moveMode=!0,"seqLine"==z.tagName){var o=Number(z.get("x1")),s=Number(z.get("y1")),i=Number(z.get("x2")),n=Number(z.get("y2"));0<z.group.joinDots[0].connected.length||z.group.joinDots[1].connected.length,z.set("x1",o+t),z.set("y1",s+e),z.set("x2",i+t),z.set("y2",n+e)}else if("line"==z.tagName||"flowline"==z.tagName||"flowline3d"==z.tagName){if(0<z.group.joinDots[0].connected.length||0<z.group.joinDots[1].connected.length)return;o=Number(z.get("x1")),s=Number(z.get("y1")),i=Number(z.get("x2")),n=Number(z.get("y2"));z.set("x1",o+t),z.set("y1",s+e),z.set("x2",i+t),z.set("y2",n+e)}else if("freeline"==z.tagName||"basicPathDot"==z.tagName)for(var a=0;a<z.options.dotsPos.length;a++)z.options.dotsPos[a].x=z.options.dotsPos[a].x+t,z.options.dotsPos[a].y=z.options.dotsPos[a].y+e;else{var r=Number(z.get("x"))+t,g=Number(z.get("y"))+e;z.set("x",r),z.set("y",g)}z.moveJoinDots(),z.calcWidthHeight(),z.draw(109)}},z.moveJoinDots=function(){if((null==z.get("draw")||0!=z.get("draw"))&&1==z.options.baseSp){if(null==z.group)return;if(null==z.group.joinDots)return;for(var t=0;t<z.group.joinDots.length;t++)if(0<z.group.joinDots[t].connected.length)for(var e=0;e<z.group.joinDots[t].connected.length;e++)if(null!=z.group.joinDots[t].connected[e]){var o=z.group.joinDots[t].connectedIndex[e];if(null==z.parentGroup)z.group.joinDots[t].connected[e].movePointXY(o,Number(z.get("x"))+Number(z.options.joinDotsPosCalc[t].x),Number(z.get("y"))+Number(z.options.joinDotsPosCalc[t].y));else{var s=z.parentGroup;if(null==s.parentGroup){var i=sedLib.getRotatePos(s.get("rotate"),Number(z.get("x"))+Number(z.options.joinDotsPosCalc[t].x),Number(z.get("y")+Number(z.options.joinDotsPosCalc[t].y)));z.group.joinDots[t].connected[e].movePointXY(o,Number(s.get("x")+i.x),Number(s.get("y")+i.y))}else{var n=s.parentGroup;if(null==n.parentGroup)z.group.joinDots[t].connected[e].movePointXY(o,Number(s.get("x")+n.get("x")+z.get("x"))+Number(z.options.joinDotsPosCalc[t].x),Number(s.get("y")+n.get("y")+z.get("y"))+Number(z.options.joinDotsPosCalc[t].y));else{var a=n.parentGroup;if(null==a.parentGroup)z.group.joinDots[t].connected[e].movePointXY(o,Number(s.get("x")+n.get("x")+a.get("x")+z.get("x"))+Number(z.options.joinDotsPosCalc[t].x),Number(s.get("y")+n.get("y")+a.get("y")+z.get("y"))+Number(z.options.joinDotsPosCalc[t].y));else{var r=a.parentGroup;if(null==r.parentGroup)z.group.joinDots[t].connected[e].movePointXY(o,Number(s.get("x")+n.get("x")+a.get("x")+r.get("x")+z.get("x"))+Number(z.options.joinDotsPosCalc[t].x),Number(s.get("y")+n.get("y")+a.get("y")+r.get("y")+z.get("y"))+Number(z.options.joinDotsPosCalc[t].y));else{var g=r.parentGroup;z.group.joinDots[t].connected[e].movePointXY(o,Number(s.get("x")+n.get("x")+a.get("x")+r.get("x")+g.get("x")+z.get("x"))+Number(z.options.joinDotsPosCalc[t].x),Number(s.get("y")+n.get("y")+a.get("y")+r.get("y")+g.get("y")+z.get("y"))+Number(z.options.joinDotsPosCalc[t].y))}}}}}z.group.joinDots[t].connected[e].options.lineMoveMode="A"}}},z.active=function(){null!=z.group&&(z.group.oncontextmenu=function(t){return!1},z.onmousebuttonleft=function(t){if(null!=z.options&&null!=z.options.selectable&&0==z.options.selectable)return!1;if(1==z.options.layer||1==z.options.layer3d)return!1;if(1!=z.sed.editPopMode&&(closeContextMenu(),cancelContextMenuBasicPathDot(),z.sed.hideJoinDotAll(),(z.sed.svg.selectedFg=z).sed.svg.selectedFg.showDot()),"freeline"==z.tagName||"basicPathDot"==z.tagName){var e=t.y;return t.y+240>window.innerHeight&&(e=window.innerHeight-240),(o=document.getElementById("contextMenuBasicPathDot")).style.float="right",o.style.left=t.x+10+"px",o.style.top=e+"px",o.style.position="absolute",o.style.float=!0,!(o.style.display="block")}var o=document.getElementById("contextMenu");e=t.y;return t.y+560>window.innerHeight&&(e=window.innerHeight-560),o.style.float="right",o.style.left=t.x+10+"px",o.style.top=e+"px",o.style.position="absolute",o.style.float=!0,o.style.display="block","selectedRectangle"==z.tagName?(document.getElementById("areaMostDown").style.display="none",document.getElementById("areaDown").style.display="none",document.getElementById("areaMostUp").style.display="none",document.getElementById("areaUp").style.display="none",document.getElementById("areaCopy").style.display="block",document.getElementById("areaPaste").style.display="none",document.getElementById("areaEditDot").style.display="none",document.getElementById("areaEditPop").style.display="none",document.getElementById("areaTestStateOn").style.display="none",document.getElementById("areaTestStateOff").style.display="none",document.getElementById("areaCreateDelete").style.display="none",document.getElementById("areaCreateGroup").style.display="block",document.getElementById("areaDeleteGroup").style.display="none",document.getElementById("areaDepartFolder").style.display="none",document.getElementById("areaRegisterToolbar").style.display="none",document.getElementById("areaUpdateToolbar").style.display="none"):null!=z.parentGroup&&1==z.parentGroup.options.folder?(document.getElementById("areaCopy").style.display="block",document.getElementById("areaPaste").style.display="none",document.getElementById("areaMostDown").style.display="none",document.getElementById("areaDown").style.display="none",document.getElementById("areaMostUp").style.display="none",document.getElementById("areaUp").style.display="none",document.getElementById("areaEditDot").style.display="none",document.getElementById("areaEditPop").style.display="none",document.getElementById("areaTestStateOn").style.display="none",document.getElementById("areaTestStateOff").style.display="none",document.getElementById("areaCreateDelete").style.display="none",document.getElementById("areaDepartFolder").style.display="block",document.getElementById("areaCreateGroup").style.display="none",document.getElementById("areaDeleteGroup").style.display="none",document.getElementById("areaRegisterToolbar").style.display="none",document.getElementById("areaUpdateToolbar").style.display="none"):"groupNone"==z.tagName?(document.getElementById("areaCopy").style.display="block",document.getElementById("areaPaste").style.display="none",document.getElementById("areaMostDown").style.display="none",document.getElementById("areaDown").style.display="none",document.getElementById("areaMostUp").style.display="none",document.getElementById("areaUp").style.display="none",document.getElementById("areaEditDot").style.display="none",document.getElementById("areaEditPop").style.display="none",document.getElementById("areaTestStateOn").style.display="none",document.getElementById("areaTestStateOff").style.display="none",document.getElementById("areaCreateDelete").style.display="none",document.getElementById("areaDeleteGroup").style.display="block",document.getElementById("areaCreateGroup").style.display="none",document.getElementById("areaDepartFolder").style.display="none",document.getElementById("areaRegisterToolbar").style.display="block",document.getElementById("areaUpdateToolbar").style.display="block"):(null==z.sed.svg.selectedFg?(document.getElementById("areaCopy").style.display="none",document.getElementById("areaPaste").style.display="block",document.getElementById("areaMostDown").style.display="none",document.getElementById("areaDown").style.display="none",document.getElementById("areaMostUp").style.display="none",document.getElementById("areaUp").style.display="none",document.getElementById("areaEditDot").style.display="none",document.getElementById("areaEditPop").style.display="none",document.getElementById("areaTestStateOn").style.display="none",document.getElementById("areaTestStateOff").style.display="none",document.getElementById("areaCreateDelete").style.display="none",document.getElementById("areaRegisterToolbar").style.display="none",document.getElementById("areaUpdateToolbar").style.display="none"):"basic"==z.sed.svg.selectedFg.tagName?(document.getElementById("areaCopy").style.display="block",document.getElementById("areaPaste").style.display="none",document.getElementById("areaMostDown").style.display="block",document.getElementById("areaDown").style.display="block",document.getElementById("areaMostUp").style.display="block",document.getElementById("areaUp").style.display="block",document.getElementById("areaTestStateOn").style.display="block",document.getElementById("areaTestStateOff").style.display="block","path"==z.sed.svg.selectedFg.options.basicData.objects[0].type?document.getElementById("areaEditDot").style.display="block":document.getElementById("areaEditDot").style.display="none",document.getElementById("areaEditPop").style.display="block",document.getElementById("areaRegisterToolbar").style.display="block",document.getElementById("areaUpdateToolbar").style.display="block"):"basic3d"==z.sed.svg.selectedFg.tagName?(document.getElementById("areaCopy").style.display="block",document.getElementById("areaPaste").style.display="none",document.getElementById("areaMostDown").style.display="block",document.getElementById("areaDown").style.display="block",document.getElementById("areaMostUp").style.display="block",document.getElementById("areaUp").style.display="block",document.getElementById("areaEditDot").style.display="none",document.getElementById("areaEditPop").style.display="block",document.getElementById("areaTestStateOn").style.display="block",document.getElementById("areaTestStateOff").style.display="block",document.getElementById("areaRegisterToolbar").style.display="block",document.getElementById("areaUpdateToolbar").style.display="block"):"line"==z.sed.svg.selectedFg.tagName||"flowline"==z.sed.svg.selectedFg.tagName?(document.getElementById("areaCopy").style.display="block",document.getElementById("areaPaste").style.display="none",document.getElementById("areaMostDown").style.display="block",document.getElementById("areaDown").style.display="block",document.getElementById("areaMostUp").style.display="block",document.getElementById("areaUp").style.display="block",document.getElementById("areaEditDot").style.display="none",document.getElementById("areaEditPop").style.display="block",document.getElementById("areaTestStateOn").style.display="none",document.getElementById("areaTestStateOff").style.display="none",document.getElementById("areaCreateDelete").style.display="block",document.getElementById("areaRegisterToolbar").style.display="block",document.getElementById("areaUpdateToolbar").style.display="block"):(document.getElementById("areaCopy").style.display="block",document.getElementById("areaPaste").style.display="none",document.getElementById("areaMostDown").style.display="block",document.getElementById("areaDown").style.display="block",document.getElementById("areaMostUp").style.display="block",document.getElementById("areaUp").style.display="block",document.getElementById("areaEditDot").style.display="none",document.getElementById("areaEditPop").style.display="none",document.getElementById("areaTestStateOn").style.display="none",document.getElementById("areaTestStateOff").style.display="none",document.getElementById("areaCreateDelete").style.display="block",document.getElementById("areaRegisterToolbar").style.display="none",document.getElementById("areaUpdateToolbar").style.display="none"),document.getElementById("areaCreateGroup").style.display="none",document.getElementById("areaDeleteGroup").style.display="none",document.getElementById("areaDepartFolder").style.display="none"),!1},z.orgRotate=0,z.group.ondblclick=function(){if(event.stopPropagation(),0!=z.sed.editMode&&"normal"==z.sed.editType&&(null==z.parentLayer||null==z.parentLayer.options||0!=z.parentLayer.options.selectable))if(null!=z.tagName&&"video"==z.tagName);else if(null!=z.tagName&&"layer"==z.tagName);else if(null!=z.get("baseFg")&&1==z.get("baseFg"))if("line"==z.tagName||"flowline"==z.tagName||"freeline"==z.tagName||"basicPathDot"==z.tagName||"flowline3d"==z.tagName);else if(null==z.options.hmiInsType||"1"!=z.options.hmiInsType&&"2"!=z.options.hmiInsType&&"3"!=z.options.hmiInsType)openModal("textBox"),document.getElementById("textEditor").contentWindow.document.body.style["font-size"]=z.get("fontSize")+"px",null!=z.get("text")&&""!=z.get("text")||setTimeout(function(){command("justifyCenter"),command("insertText"," "),command("selectAll"),command("justifyCenter")},1e3);else{openModal("hmiIns");var t="",e="",o="";"1"==z.options.hmiInsType?(t=z.options.hmiData.objects[1].text,document.getElementById("hmiInsTop").value=t,document.getElementById("hmiInsBottom").value=o):"2"!=z.options.hmiInsType&&"3"!=z.options.hmiInsType||(t=z.options.hmiData.objects[2].text,e=z.options.hmiData.objects[1].strokeDasharray,o=z.options.hmiData.objects[3].text,document.getElementById("hmiInsTop").value=t,document.getElementById("hmiInsLine").value=e,document.getElementById("hmiInsBottom").value=o)}},z.posGabX=0,z.posGabY=0,z.group.ontouchstart=function(t){},z.group.onmousedown=function(t){if(null!=z.parentGroup&&"groupNone"==z.parentGroup.group.fg.tagName||t.stopPropagation(),0!=z.sed.editMode||"move"==z.sed.editType){if(1!=z.sed.editPopMode&&null!=z.svg.selectedFg&&z.svg.selectedFg.hideDot(),z.sed.resizeMode=!1,1!=z.sed.editPopMode&&(z.svg.selectedDownFg=null,z.svg.selectedFg=null),z.svg.downOffsetX=t.screenX,z.svg.downOffsetY=t.screenY,2==t.button)return"move"==((z.svg.selectedFg=z).sed.svg.selectedFg=z).sed.editType||(setTimeout(function(){z.onmousebuttonleft(t)},200),!1);1==z.sed.editMode&&1!=z.sed.editPopMode&&(cancelContextMenuBasicPathDot(),closeContextMenu()),"selectedRectangle"!=z.tagName&&(z.sed.svg.groupSelectMode=!1,z.sed.svg.groupSelectedMode=!1,z.sed.svg.selectedRectangle.setHidden("hidden"),z.sed.svg.selectedRectangle.hideDot()),document.createEvent?z.svg.dispatchEvent(new Event("mousedown")):z.svg.fireEvent("onmousedown",t),null!=z.options.layer3d&&null!=z.options.layer3d&&1==z.options.layer3d||("fillColor"==z.sed.moveMode||"lineColor"==z.sed.moveMode||(z.sed.moveMode="fg"),1==z.sed.editMode&&"normal"==z.sed.editType&&(document.querySelector("[ref=chkLayerMove]").checked=!1)),z.sed.svg.beforeOffsetX=t.screenX,z.sed.svg.beforeOffsetY=t.screenY,1!=z.sed.mousedown&&(null!=z.parentGroup&&z.parentGroup.group.fg.get("folder"),z.posGabX=t.offsetX-z.get("x"),z.posGabY=t.offsetY-z.get("y"),null!=z.parentLayer&&null!=z.parentLayer.options&&0==z.parentLayer.options.selectable||setTimeout(function(){if("canvas"!=z.sed.moveMode){if("layer"==z.sed.moveMode){if(null==z.options.layer||0==z.options.layer)return}else if("fg"==z.sed.moveMode){if(null!=z.options.layer&&1==z.options.layer)return}else"fillColor"==z.sed.moveMode?null!=z.options.layer&&0!=z.options.layer||(z.group.tag.setAttribute("fill",z.sed.fillColor),z.set("fill",z.sed.fillColor)):"lineColor"==z.sed.moveMode&&(null!=z.options.layer&&0!=z.options.layer||(z.group.tag.setAttribute("stroke",z.sed.lineColor),z.set("stroke",z.sed.lineColor)));1==z.sed.svg.groupSelectedMode?(null!=(z.svg.selectedMousedownFg=z).svg.selectedFg&&z.options.figureId!=z.svg.selectedFg.options.figureId&&z.svg.selectedFg.hideDot(),((z.svg.selectedDownFg=z).svg.selectedFg=z).svg.selectedFg.showDot()):(null!=(z.svg.selectedMousedownFg=z).svg.selectedFg&&z.options.figureId!=z.svg.selectedFg.options.figureId&&z.svg.selectedFg.hideDot(),((z.svg.selectedDownFg=z).svg.selectedFg=z).svg.selectedFg.showDot(),setTimeout(function(){null!=z.sed&&z.sed.setProperties(z)},100))}},20))}},null!=z.group.img&&null!=z.group.img&&(z.group.img.onmouseup=function(t){z.group.onmouseup(t)}),z.group.onmouseup=function(t){if(1!=z.sed.editMode||2==t.button||null==z.svg.selectedFg||"layer3d"!=z.svg.selectedFg.tagName||null==z.svg.selectedDownFgDot){if(t.stopPropagation(),null!=z.options.mouseupEvent&&1==z.options.mouseupEvent){var e=new CustomEvent("sed",{detail:{fg:z,sedEvent:"mouseup"}});z.sed.div.dispatchEvent(e)}if(z.sed.resizeMode=!1,2!=t.button)if(0!=z.sed.editMode||"move"==z.sed.editType)if(null==z.options||0!=z.options.selectable)if(1==z.sed.svg.groupSelectMode&&(z.svg.selectedFg=z.sed.svg.selectedRectangle),null!=z.svg.selectedFg)if(z.sed.rotateMode=!1,"selectedRectangle"==z.svg.selectedFg.tagName||null!=z.svg.selectedFg.parentLayer)if(null==z.svg.selectedFg.get("draw")||0!=z.svg.selectedFg.get("draw"))if(null==z.svg.selectedFg.get("layer")||1!=z.svg.selectedFg.get("layer"))if("flowline3d"==z.svg.selectedFg.tagName&&(z.svg.selectedFg.parentLayer.group.appendChild(z.svg.selectedFg.group),z.svg.selectedFg.set("parentLayer",z.svg.selectedFg.parentLayer.get("parentLayer"))),1!=z.svg.selectedFg.options.fix&&1!=z.svg.selectedFg.options.mapFixPos){if(null!=z.svg.selectedDownFg&&1==z.svg.selectedDownFg.get("group"))for(var o=z.svg.selectedDownFg.group.querySelectorAll("[baseFg=true]"),s=0;s<o.length;s++){var i=o[s].parentNode.fg;i.moveTo(0,0),i.moveJoinDots(),i.calcWidthHeight(),i.draw(110)}var n,a;z.sed.div.offsetTop,z.sed.div.offsetLeft;if(a=null==z.svg.selectedFg.parentLayer?(n=t.offsetX/z.sed.screenRatio,t.offsetY/z.sed.screenRatio):"ie"==sedLib.browserCls||"edge"==sedLib.browserCls?(n=t.x/z.sed.screenRatio-z.svg.selectedFg.parentLayer.get("x"),t.y/z.sed.screenRatio-z.svg.selectedFg.parentLayer.get("y")):"firefox"==sedLib.browserCls?(n=t.layerX/z.sed.screenRatio-z.svg.selectedFg.parentLayer.get("x"),t.layerY/z.sed.screenRatio-z.svg.selectedFg.parentLayer.get("y")):(n=t.offsetX/z.sed.screenRatio-z.svg.selectedFg.parentLayer.get("x"),t.offsetY/z.sed.screenRatio-z.svg.selectedFg.parentLayer.get("y")),1==z.svg.selectedFg.get("seqFgAxis"))return sedLib.setSequenceAxisPosition(n,a,z.svg.selectedFg,z.svg.selectedFg.sed),void(z.sed.svg.selectedDownFgDot=null);if(1==z.sed.svg.groupSelectMode&&null!=z.sed.svg.selectedRectangle){var r=z.sed.svg.selectedRectangle.get("x")-Math.abs(z.sed.svg.selectedRectangle.get("width"))/2,g=z.sed.svg.selectedRectangle.get("x")+Math.abs(z.sed.svg.selectedRectangle.get("width"))/2,l=z.sed.svg.selectedRectangle.get("y")-Math.abs(z.sed.svg.selectedRectangle.get("height"))/2,d=z.sed.svg.selectedRectangle.get("y")+Math.abs(z.sed.svg.selectedRectangle.get("height"))/2,u=z.sed.svg.querySelectorAll("[baseFg=true]"),p=0;z.sed.svg.groupSelectedArray=[];for(s=0;s<u.length;s++){var c=u[s].parentNode.fg;c.options.groupLeft>=r&&c.options.groupRight<=g&&c.options.groupTop>=l&&c.options.groupBottom<=d&&(z.sed.svg.groupSelectedArray.push(c),p++)}0==p?(z.sed.svg.selectedRectangle.setHidden("hidden"),z.sed.svg.selectedRectangle.hideDot(),z.sed.svg.groupSelectMode=!1,z.sed.svg.groupSelectedMode=!1):(z.sed.svg.groupSelectMode=!0,z.sed.svg.groupSelectedMode=!0,z.svg.selectedFg=z.sed.svg.selectedRectangle)}if("layer"!=z.tagName&&0==sedLib.nvl(z.get("folder"))){if(null!=z.svg.selectedDownFg&&sedLib.nvl(z.svg.selectedDownFg.get("parentGroup"))==z.options.figureId)return;for(u=z.sed.svg.selectedLayer.group.querySelectorAll("[folder=true]"),s=0;s<u.length;s++){if((E=u[s].parentNode.fg)!=z.svg.selectedFg&&(null==z.svg.selectedFg.parentGroup||null==z.svg.selectedFg.parentGroup)){var h=!1;if(null==z.parentGroup&&"flowline"!=z.tagName&&"freeline"!=z.tagName&&"basicPathDot"!=z.tagName&&"line"!=z.tagName&&"flowline3d"!=z.tagName&&"seqLine"!=z.tagName&&"selectedRectangle"!=z.tagName&&(n>=Number(E.get("groupLeft"))&&n<=Number(E.get("groupRight"))&&a>=Number(E.get("groupTop"))&&a<=Number(E.get("groupBottom"))&&(h=!0),1==h)){var b="Do you want to move it in the folder?";if(1!=confirm(b))return void(z.sed.svg.selectedDownFgDot=null);if(1==E.options.basic3d){for(var y=E.getHeight3D(),m=E.group.querySelectorAll("[baseFg=true]"),D=0;D<m.length;D++){if((f=m[D].parentNode.fg)!=E)if(1==f.options.basic3d)y+=f.getHeight3D();else y+=(f=m.parentNode.fg).get("height")}z.svg.selectedFg.set("x",0),z.svg.selectedFg.set("y",-1*y),z.redraw(111)}else{for(y=E.get("height")/-2,m=E.group.querySelectorAll("[baseFg=true]"),D=0;D<m.length;D++){var f;(f=m[D].parentNode.fg)!=E&&(1==f.options.basic3d?y+=f.getHeight3D():y+=f.get("height"))}z.svg.selectedFg.set("x",0),z.svg.selectedFg.set("y",y+z.get("height")/2),z.svg.selectedFg.redraw(),z.redraw(117)}if(z.svg.selectedFg.parentGroup=E,z.svg.selectedFg.set("parentGroup",E.get("figureId")),E.group.appendChild(z.svg.selectedFg.group),(z.sed.svg.selectedDownFgDot=null)!=E.options.basicData&&null!=E.options.basicData)for(var v=0;v<E.options.basicData.objects.length;v++)null!=E.options.basicData.objects[v].groupFront&&1==E.options.basicData.objects[v].groupFront&&E.group.appendChild(E.group.subGroup[v]);return}}}}else if(1==sedLib.nvl(z.get("folder"))){if(1==sedLib.nvl(z.svg.selectedFg.get("folder"))&&z.svg.selectedFg.get("figureId")!=z.get("figureId"))return void(z.sed.svg.selectedDownFgDot=null);if(0==sedLib.nvl(z.svg.selectedFg.get("folder"))){if(sedLib.nvl(z.svg.selectedFg.get("parentGroup"))==z.options.figureId)return void(z.sed.svg.selectedDownFgDot=null);if(null!=z.svg.selectedFg&&null!=z.svg.selectedFg.tagName&&"line"!=z.svg.selectedFg.tagName&&"flowline"!=z.svg.selectedFg.tagName&&"freeline"!=z.svg.selectedFg.tagName&&"basicPathDot"!=z.svg.selectedFg.tagName&&"flowline3d"!=z.svg.selectedFg.tagName&&"seqLine"!=z.svg.selectedFg.tagName&&"selectedRectangle"!=z.svg.selectedFg.tagName){b="Do you want to include it in the folder?";if(1==confirm(b))return(z.svg.selectedFg.parentGroup=z).svg.selectedFg.set("parentGroup",z.get("figureId")),z.group.appendChild(z.svg.selectedFg.group),z.svg.selectedFg.set("x",10+z.svg.selectedFg.get("width")/2+z.svg.selectedFg.parentGroup.get("width")/-2),z.svg.selectedFg.set("y",10+z.svg.selectedFg.get("height")/2+z.svg.selectedFg.parentGroup.get("height")/-2),void(z.sed.svg.selectedDownFgDot=null)}}}if(1==z.svg.selectedFg.moveMode)if(null!=z.svg.selectedFg.get("d3")&&1==z.svg.selectedFg.get("d3"))z.svg.selectedFg.setBlockPosByXY(z.svg.selectedFg.get("x"),z.svg.selectedFg.get("y"));else if(1==z.sed.rulerAlign){if(null==t.target.getAttribute("groupAction")||1!=t.target.getAttribute("groupAction")&&"true"!=t.target.getAttribute("groupAction"))if("ie"==sedLib.browserCls||"edge"==sedLib.browserCls)n=(t.x-t.offsetX%(z.sed.rulerSizeX*z.sed.screenRatio))/z.sed.screenRatio-z.parentLayer.get("x"),a=(t.y-t.offsetY%(z.sed.rulerSizeY*z.sed.screenRatio))/z.sed.screenRatio-z.parentLayer.get("y");else if("firefox"==sedLib.browserCls){n=Number(z.svg.selectedFg.get("x"))-z.svg.selectedFg.get("width")/2,a=Number(z.svg.selectedFg.get("y"))-z.svg.selectedFg.get("height")/2;var x=n%z.sed.rulerSizeX,w=a%z.sed.rulerSizeY;z.sed.rulerSizeX/2<x&&(x=-1*(z.sed.rulerSizeX-x)),z.sed.rulerSizeY/2<w&&(w=-1*(z.sed.rulerSizeY-w)),n-=x,a-=w,n+=z.svg.selectedFg.get("width")/2,a+=z.svg.selectedFg.get("height")/2}else{n=Number(z.svg.selectedFg.get("x"))-z.svg.selectedFg.get("width")/2,a=Number(z.svg.selectedFg.get("y"))-z.svg.selectedFg.get("height")/2;x=n%z.sed.rulerSizeX,w=a%z.sed.rulerSizeY;z.sed.rulerSizeX/2<x&&(x=-1*(z.sed.rulerSizeX-x)),z.sed.rulerSizeY/2<w&&(w=-1*(z.sed.rulerSizeY-w)),n-=x,a-=w,n+=z.svg.selectedFg.get("width")/2,a+=z.svg.selectedFg.get("height")/2}else a="ie"==sedLib.browserCls||"edge"==sedLib.browserCls?(n=(t.x-t.offsetX%(z.sed.rulerSizeX*z.sed.screenRatio)+z.get("width")/2*z.sed.screenRatio)/z.sed.screenRatio-z.parentLayer.get("x"),(t.y-t.offsetY%(z.sed.rulerSizeY*z.sed.screenRatio)+z.get("height")/2*z.sed.screenRatio)/z.sed.screenRatio-z.parentLayer.get("y")):"firefox"==sedLib.browserCls?(n=(t.layerX-t.layerX%(z.sed.rulerSizeX*z.sed.screenRatio)+z.get("width")/2*z.sed.screenRatio)/z.sed.screenRatio-z.svg.selectedFg.parentLayer.get("x"),(t.layerY-t.layerY%(z.sed.rulerSizeY*z.sed.screenRatio)+z.get("height")/2*z.sed.screenRatio)/z.sed.screenRatio-z.svg.selectedFg.parentLayer.get("y")):(n=(t.offsetX-t.offsetX%(z.sed.rulerSizeX*z.sed.screenRatio)+z.get("width")/2*z.sed.screenRatio)/z.sed.screenRatio-z.svg.selectedFg.parentLayer.get("x"),(t.offsetY-t.offsetY%(z.sed.rulerSizeY*z.sed.screenRatio)+z.get("height")/2*z.sed.screenRatio)/z.sed.screenRatio-z.svg.selectedFg.parentLayer.get("y"));"seqLine"==z.tagName||"line"==z.tagName||("flowline"==z.tagName||"freeline"==z.tagName||"basicPathDot"==z.tagName||"flowline3d"==z.tagName?z.draw(118):z.svg.selectedFg.moveXY(n,a))}else 1==z.svg.selectedFg.options.baseRuler?sedLib.moveRuler(z.svg.selectedFg):"seqLine"==z.svg.selectedFg.tagName||"line"==z.svg.selectedFg.tagName||("flowline"==z.svg.selectedFg.tagName||"freeline"==z.svg.selectedFg.tagName||"basicPathDot"==z.svg.selectedFg.tagName||"flowline3d"==z.tagName?z.draw(119):"selectedRectangle"!=z.svg.selectedFg.tagName&&sedLib.getNearByRuler(z.svg.selectedFg,"move"));else 1!=z.options.layer&&1==z.options.baseFg&&1==z.sed.resizeMode&&1!=z.svg.selectedFg.get("baseRuler")&&"selectedRectangle"!=z.svg.selectedFg.tagName&&sedLib.getNearByRuler(z.svg.selectedFg,"move");if(z.moveMode=!1,"line"==z.svg.selectedFg.tagName||"seqLine"==z.svg.selectedFg.tagName||"flowline"==z.svg.selectedFg.tagName||"flowline3d"==z.svg.selectedFg.tagName){if(null!=z.svg.selectedDownFgDot){var N=z.svg.selectedFg.group.joinDots[z.svg.selectedDownFgDotIndex].connected;for(s=0;s<N.length;s++)if(null!=N[s]){var P=z.svg.selectedFg.group.joinDots[z.svg.selectedDownFgDotIndex].connected[s],A=z.svg.selectedFg.group.joinDots[z.svg.selectedDownFgDotIndex].connectedIndex[s];if(null!=P)for(var F=0;F<P.group.joinDots[A].connected.length;F++)if(P.group.joinDots[A].connected[F]==z.svg.selectedFg){P.group.joinDots[A].connected.splice(F,1),P.group.joinDots[A].connectedIndex.splice(F,1),P.options.connectedId[A].splice(F,1),P.options.connectedIndex[A].splice(F,1);break}}z.svg.selectedFg.group.joinDots[z.svg.selectedDownFgDotIndex].connected=[],z.svg.selectedFg.group.joinDots[z.svg.selectedDownFgDotIndex].connectedIndex=[],z.svg.selectedFg.options.connectedId[z.svg.selectedDownFgDotIndex]=[],z.svg.selectedFg.options.connectedIndex[z.svg.selectedDownFgDotIndex]=[]}if(null!=z.svg.selectedDownFgDot)for(var T=(u=z.svg.querySelectorAll("[baseFg=true]")).length-1;0<=T;T--){if("line"!=(E=u[T].parentNode.fg).get("tagName")&&"flowline"!=E.get("tagName")&&"freeline"!=E.get("tagName")&&"basicPathDot"!=E.get("tagName")&&"flowline3d"!=E.get("tagName")&&"seqLine"!=E.get("tagName")){h=!1;var I=sedLib.getPosCalc2(E,n,a);if(null!=I){var M=I.index,j=!0;if(null!=z.sed.diagramType&&"flowdiagram"==z.sed.diagramType){var k=null,B=null;0<z.svg.selectedFg.group.joinDots[0].connected.length&&(k=z.svg.selectedFg.group.joinDots[0].connected[0]),0<z.svg.selectedFg.group.joinDots[1].connected.length&&(B=z.svg.selectedFg.group.joinDots[1].connected[0]),0==z.svg.selectedDownFgDotIndex?k=E:1==z.svg.selectedDownFgDotIndex&&(B=E),j=sedLib.connectEnableCheck(k,B,M,z.sed,z.svg.selectedDownFgDotIndex)}if(1==j){z.svg.selectedFg.movePointXY(z.svg.selectedDownFgDotIndex,Number(I.x),Number(I.y)),E.group.joinDots[M].connected.push(z.svg.selectedFg),E.group.joinDots[M].connectedIndex.push(z.svg.selectedDownFgDotIndex),E.options.connectedId[M].push(z.svg.selectedFg.options.figureId),E.options.connectedIndex[M].push(z.svg.selectedDownFgDotIndex),z.svg.selectedFg.group.joinDots[z.svg.selectedDownFgDotIndex].connected.push(E),z.svg.selectedFg.group.joinDots[z.svg.selectedDownFgDotIndex].connectedIndex.push(M),z.svg.selectedFg.options.connectedId[z.svg.selectedDownFgDotIndex].push(E.options.figureId),z.svg.selectedFg.options.connectedIndex[z.svg.selectedDownFgDotIndex].push(M);break}}}}else if(null!=z.svg.selectedDownFgDot&&null!=z.svg.targetFg){var E=z.svg.targetFg,L=(M=0,[]);for(s=0;s<E.group.joinDots.length;s++){var C=E.options.x+E.options.joinDotsPosCalc[s].x-n,S=E.options.y+E.options.joinDotsPosCalc[s].y-a;L[s]=Number(C*C)+Number(S*S)}M=0;var R=L[0];for(s=1;s<E.group.joinDots.length;s++)L[s]<R&&(R=L[s],M=s);j=!0;if(null!=z.sed.diagramType&&"flowdiagram"==z.sed.diagramType){k=null,B=null;0<z.svg.selectedFg.group.joinDots[0].connected.length&&(k=z.svg.selectedFg.group.joinDots[0].connected[0]),0<z.svg.selectedFg.group.joinDots[1].connected.length&&(B=z.svg.selectedFg.group.joinDots[1].connected[0]),j=sedLib.connectEnableCheck(k,B,M,z.sed)}1==j&&(z.svg.selectedFg.movePointXY(z.svg.selectedDownFgDotIndex,Number(E.options.x+E.options.joinDotsPosCalc[M].x),Number(E.options.y+E.options.joinDotsPosCalc[M].y)),E.group.joinDots[M].connected.push(z.svg.selectedFg),E.group.joinDots[M].connectedIndex.push(z.svg.selectedDownFgDotIndex),E.options.connectedId[M].push(z.svg.selectedFg.options.figureId),E.options.connectedIndex[M].push(z.svg.selectedDownFgDotIndex),z.svg.selectedFg.group.joinDots[z.svg.selectedDownFgDotIndex].connected.push(E),z.svg.selectedFg.group.joinDots[z.svg.selectedDownFgDotIndex].connectedIndex.push(M),z.svg.selectedFg.options.connectedId[z.svg.selectedDownFgDotIndex].push(E.options.figureId),z.svg.selectedFg.options.connectedIndex[z.svg.selectedDownFgDotIndex].push(M))}}z.sed.hideJoinDotAll(),null!=z.svg.selectedFg&&z.svg.selectedFg.draw(120),null!=z.svg.targetFg&&z.svg.targetFg.draw(121),z.sed.resizeMode=!1,z.draw(122),setTimeout(function(){null!=z.sed&&z.sed.setProperties(z)},50),null!=z.parentLayer&&"layerDistance"==z.parentLayer.options.figure&&sedLib.calcDistance(z),null!=z&&null!=z.parentLayer&&"layerMap"==z.parentLayer.options.figure&&sedLib.calcLatLng(z),z.svg.selectedDownFgLineDot=null,z.svg.selectedDownFgLineDotIndex=null,z.sed.svg.selectedDownFgDot=null,z.sed.setPropertiesMove(z)}else z.sed.svg.selectedDownFgDot=null;else z.sed.svg.selectedDownFgDot=null;else z.sed.svg.selectedDownFgDot=null;else z.sed.svg.selectedDownFgDot=null;else z.sed.svg.selectedDownFgDot=null;else z.sed.svg.selectedDownFgDot=null;else z.sed.svg.selectedDownFgDot=null;else z.sed.svg.selectedDownFgDot=null}},z.group.onmousemove=function(t){0!=z.sed.editMode&&null!=z.svg.selectedFg&&(null!=z.svg.selectedFg.get("draw")&&0==z.svg.selectedFg.get("draw")||z.sed.setPropertiesMove(z))},z.group.onmouseout=function(){0!=z.sed.editMode&&(null!=z.get("draw")&&0==z.get("draw")||z.svg.targetFg==z&&(z.svg.targetFg=null))},null==z.options||null==z.group.dots||1==z.options.layer&&1!=z.options.layer3d||(z.group.dots[0].onmousedown=function(t){z.svg.selectedDownFgDot=z.group.dots[0],z.svg.selectedDownFgDotIndex=0,z.sed.resizeMode=!0},z.group.dots[1].onmousedown=function(t){z.svg.selectedDownFgDot=z.group.dots[1],z.svg.selectedDownFgDotIndex=1,z.sed.resizeMode=!0},"freeline"!=z.tagName&&"basicPathDot"!=z.tagName||(3<=z.group.dots.length?z.group.dots[2].onmousedown=function(t){z.svg.selectedDownFgDot=z.group.dots[2],z.svg.selectedDownFgDotIndex=2,z.sed.resizeMode=!0}:4<=z.group.dots.length?z.group.dots[3].onmousedown=function(t){z.svg.selectedDownFgDot=z.group.dots[3],z.svg.selectedDownFgDotIndex=3,z.sed.resizeMode=!0}:5<=z.group.dots.length?z.group.dots[4].onmousedown=function(t){z.svg.selectedDownFgDot=z.group.dots[4],z.svg.selectedDownFgDotIndex=4,z.sed.resizeMode=!0}:6<=z.group.dots.length?z.group.dots[5].onmousedown=function(t){z.svg.selectedDownFgDot=z.group.dots[5],z.svg.selectedDownFgDotIndex=5,z.sed.resizeMode=!0}:7<=z.group.dots.length?z.group.dots[6].onmousedown=function(t){z.svg.selectedDownFgDot=z.group.dots[6],z.svg.selectedDownFgDotIndex=6,z.sed.resizeMode=!0}:8<=z.group.dots.length&&(z.group.dots[7].onmousedown=function(t){z.svg.selectedDownFgDot=z.group.dots[7],z.svg.selectedDownFgDotIndex=7,z.sed.resizeMode=!0})),"flowline"!=z.tagName&&"flowline3d"!=z.tagName||(z.group.lineDots[0].onmousedown=function(t){z.svg.selectedDownFgLineDot=z.group.lineDots[0],z.svg.selectedDownFgLineDotIndex=0,z.sed.resizeMode=!0},z.group.lineDots[1].onmousedown=function(t){z.svg.selectedDownFgLineDot=z.group.lineDots[1],z.svg.selectedDownFgLineDotIndex=1,z.sed.resizeMode=!0},z.group.lineDots[2].onmousedown=function(t){z.svg.selectedDownFgLineDot=z.group.lineDots[2],z.svg.selectedDownFgLineDotIndex=2,z.sed.resizeMode=!0}),"line"!=z.tagName&&"flowline"!=z.tagName&&"freeline"!=z.tagName&&"basicPathDot"!=z.tagName&&"flowline3d"!=z.tagName&&"seqLine"!=z.tagName&&(z.group.dots[2].onmousedown=function(t){z.svg.selectedDownFgDot=z.group.dots[2],z.svg.selectedDownFgDotIndex=2,z.sed.resizeMode=!0},z.group.dots[3].onmousedown=function(t){z.svg.selectedDownFgDot=z.group.dots[3],z.svg.selectedDownFgDotIndex=3,z.sed.resizeMode=!0},1!=z.options.d3b&&1!=z.options.layer3d&&(z.group.dots[4].onmousedown=function(t){z.svg.selectedDownFgDot=z.group.dots[4],z.svg.selectedDownFgDotIndex=4,z.sed.resizeMode=!0},z.group.dots[5].onmousedown=function(t){z.svg.selectedDownFgDot=z.group.dots[5],z.svg.selectedDownFgDotIndex=5,z.sed.resizeMode=!0},z.group.dots[6].onmousedown=function(t){z.svg.selectedDownFgDot=z.group.dots[6],z.svg.selectedDownFgDotIndex=6,z.sed.resizeMode=!0},z.group.dots[7].onmousedown=function(t){z.svg.selectedDownFgDot=z.group.dots[7],z.svg.selectedDownFgDotIndex=7,z.sed.resizeMode=!0}),9<=z.group.dots.length&&(z.group.dots[8].onmousedown=function(t){z.svg.selectedDownFgDot=z.group.dots[8],z.svg.selectedDownFgDotIndex=8,z.sed.resizeMode=!0}),null!=z.group.rotateDot&&(z.group.rotateDot.onmousedown=function(t){if(1==z.options.d3b){var e=(z.svg.selectedFg=z).get("rotate3D");4<=++e&&(e=0),z.set("rotate3D",e),z.sed.svg.groupSelectMode=!1,z.sed.svg.groupSelectedMode=!1,z.setRotate3D(),z.moveJoinDots(),z.calcWidthHeight(),z.draw(125),setTimeout(function(){z.sed.setProperties(z)},100)}else if("text3d"==z.tagName){e=(z.svg.selectedFg=z).get("rotate3D");4<=++e&&(e=0),z.set("rotate3D",e),(z.svg.selectedFg=z).sed.svg.groupSelectMode=!1,z.sed.svg.groupSelectedMode=!1,z.draw(126)}else(z.svg.selectedFg=z).rotateMode=!0,z.sed.rotateMode=!0,z.sed.svg.groupSelectMode=!1,z.sed.svg.groupSelectedMode=!1}))))},z.calcRotateByPos=function(t,e,o,s){var i=o-t,n=e-s,a=Math.acos(n/Math.sqrt(i*i+n*n));return i<0&&(a*=-1),a},z.rotateFg=function(t,e){if((null==z.get("draw")||0!=z.get("draw"))&&(z.rotate=t,z.set("rotate",t),sedLib.getPosCalc2(z),null!=z.options.joinDotsPos)){for(var o=0;o<z.options.joinDotsPos.length;o++)z.options.joinDotsPosCalc[o]=sedLib.getRotatePos(t,z.options.joinDotsPos[o].x,z.options.joinDotsPos[o].y);null!=z.options.rotateDotPos&&(z.options.rotateDotPosCalc=sedLib.getRotatePos(t,z.options.rotateDotPos.x,z.options.rotateDotPos.y)),z.options.dotsPosCalc=[];for(o=0;o<z.options.dotsPos.length;o++)z.options.dotsPosCalc.push(sedLib.getRotatePos(t,z.options.dotsPos[o].x,z.options.dotsPos[o].y));z.moveJoinDots(),null!=e&&1!=e||z.draw(127),setTimeout(function(){null!=z.sed&&z.sed.setProperties(z.svg.selectedFg)},100)}},z.reverseHor=function(){if(!(null!=z.get("draw")&&0==z.get("draw")||"basic"!=z.options.figure&&"basic3d"!=z.options.figure)){for(var t=0;t<z.options.basicData.objects.length;t++){if("path"==z.options.basicData.objects[t].type||"guagep"==z.options.basicData.objects[t].type||"guageh"==z.options.basicData.objects[t].type||"guagev"==z.options.basicData.objects[t].type||"guagec"==z.options.basicData.objects[t].type||"guagecylindarz"==z.options.basicData.objects[t].type||"guagecubez"==z.options.basicData.objects[t].type){for(var e=z.options.basicData.objects[t].d,o=(e=e.trim()).split(" "),s="",i="",n=0;n<o.length;n++){var a="",r=!1,g=!1;-1!=o[n].indexOf("M")?(a="M",o[n]=o[n].replace("M","")):-1!=o[n].indexOf("C")?(a="C",r=!0,o[n]=o[n].replace("C","")):-1!=o[n].indexOf("Q")?(a="Q",g=!0,o[n]=o[n].replace("Q","")):-1!=o[n].indexOf("L")?(a="L",o[n]=o[n].replace("L","")):-1!=o[n].indexOf("Z")&&(a="Z",o[n]=o[n].replace("Z",""));var l=o[n].split(",")[0],d=o[n].split(",")[1];if(0==isNaN(l)&&(l=-1*Number(l)),i=a+l+","+d,1==g){var u=o[n].split(",")[2],p=o[n].split(",")[3];0==isNaN(u)&&(u=-1*Number(u)),s+=i=i+","+u+","+p}else if(1==r){u=o[n].split(",")[2],p=o[n].split(",")[3];var c=o[n].split(",")[4],h=o[n].split(",")[5],b=o[n].split(",")[6],y=o[n].split(",")[7];0==isNaN(u)&&(u=-1*Number(u)),0==isNaN(c)&&(c=-1*Number(c)),0==isNaN(b)&&(b=-1*Number(b)),s+=i=i+","+u+","+p+","+c+","+h+","+b+","+y}else s+=i;s+=" "}s=s.trim(),z.options.basicData.objects[t].d=s}else if("circle"==z.options.basicData.objects[t].type||"ellipse"==z.options.basicData.objects[t].type)z.options.basicData.objects[t].cx=-1*Number(z.options.basicData.objects[t].cx);else if("text"==z.options.basicData.objects[t].type||"guagetext"==z.options.basicData.objects[t].type)z.options.basicData.objects[t].x=-1*Number(z.options.basicData.objects[t].x);else if("textArray"==z.options.basicData.objects[t].type||"legend"==z.options.basicData.objects[t].type)for(n=0;n<z.options.basicData.objects[t].list.length;n++)z.options.basicData.objects[t].list[n].x=-1*Number(z.options.basicData.objects[t].list[n].x);null!=z.options.basicData.objects[t].skew&&null!=z.options.basicData.objects[t].skew&&("X"==z.options.basicData.objects[t].skew?z.options.basicData.objects[t].skew="Y":"Y"==z.options.basicData.objects[t].skew?z.options.basicData.objects[t].skew="X":"ZX"==z.options.basicData.objects[t].skew?z.options.basicData.objects[t].skew="ZY":"ZY"==z.options.basicData.objects[t].skew&&(z.options.basicData.objects[t].skew="ZX"))}for(t=0;t<z.options.joinDotsPos.length;t++)z.options.joinDotsPosData[t].x=-1*Number(z.options.joinDotsPosData[t].x),z.options.joinDotsPos[t].x=Number(z.options.joinDotsPosData[t].x)*z.options.width/100,"NE"==z.options.joinDotsPosData[t].dir?z.options.joinDotsPosData[t].dir="NW":"E"==z.options.joinDotsPosData[t].dir?z.options.joinDotsPosData[t].dir="W":"SE"==z.options.joinDotsPosData[t].dir?z.options.joinDotsPosData[t].dir="SW":"NW"==z.options.joinDotsPosData[t].dir?z.options.joinDotsPosData[t].dir="NE":"W"==z.options.joinDotsPosData[t].dir?z.options.joinDotsPosData[t].dir="E":"SW"==z.options.joinDotsPosData[t].dir&&(z.options.joinDotsPosData[t].dir="SE"),z.options.joinDotsPos[t].dir=z.options.joinDotsPosData[t].dir,z.group.joinDots[t].setAttribute("cx",z.options.joinDotsPos[t].x),z.group.joinDots[t].dir=z.options.joinDotsPosData[t].dir;if(null!=z.options.sizeDotsPosData)for(t=0;t<z.options.sizeDotsPosData.length;t++)z.options.sizeDotsPosData[t].x=-1*Number(z.options.sizeDotsPosData[t].x),z.options.dotsPos[0].x=z.options.sizeDotsPosData[0].x*width/100;z.refresh(2),z.redraw()}},z.reverseVer=function(){if(!(null!=z.get("draw")&&0==z.get("draw")||"basic"!=z.options.figure&&"basic3d"!=z.options.figure)){for(var t=0;t<z.options.basicData.objects.length;t++){if("path"==z.options.basicData.objects[t].type||"guagep"==z.options.basicData.objects[t].type||"guageh"==z.options.basicData.objects[t].type||"guagev"==z.options.basicData.objects[t].type||"guagec"==z.options.basicData.objects[t].type||"guagecylindarz"==z.options.basicData.objects[t].type||"guagecubez"==z.options.basicData.objects[t].type){for(var e=z.options.basicData.objects[t].d,o=(e=e.trim()).split(" "),s="",i="",n=0;n<o.length;n++){var a="",r=!1,g=!1;-1!=o[n].indexOf("M")?(a="M",o[n]=o[n].replace("M","")):-1!=o[n].indexOf("C")?(a="C",r=!0,o[n]=o[n].replace("C","")):-1!=o[n].indexOf("Q")?(a="Q",g=!0,o[n]=o[n].replace("Q","")):-1!=o[n].indexOf("L")?(a="L",o[n]=o[n].replace("L","")):-1!=o[n].indexOf("Z")&&(a="Z",o[n]=o[n].replace("Z",""));var l=o[n].split(",")[0],d=o[n].split(",")[1];if(0==isNaN(d)&&(d=-1*Number(d)),i=a+l+","+d,1==g){var u=o[n].split(",")[2],p=o[n].split(",")[3];0==isNaN(p)&&(p=-1*Number(p)),s+=i=i+","+u+","+p}else if(1==r){u=o[n].split(",")[2],p=o[n].split(",")[3];var c=o[n].split(",")[4],h=o[n].split(",")[5],b=o[n].split(",")[6],y=o[n].split(",")[7];0==isNaN(p)&&(p=-1*Number(p)),0==isNaN(h)&&(h=-1*Number(h)),0==isNaN(y)&&(y=-1*Number(y)),s+=i=i+","+u+","+p+","+c+","+h+","+b+","+y}else s+=i;s+=" "}s=s.trim(),z.options.basicData.objects[t].d=s}else if("circle"==z.options.basicData.objects[t].type||"ellipse"==z.options.basicData.objects[t].type)z.options.basicData.objects[t].cy=-1*Number(z.options.basicData.objects[t].cy);else if("text"==z.options.basicData.objects[t].type||"guagetext"==z.options.basicData.objects[t].type)z.options.basicData.objects[t].y=-1*Number(z.options.basicData.objects[t].y);else if("textArray"==z.options.basicData.objects[t].type||"legend"==z.options.basicData.objects[t].type)for(n=0;n<z.options.basicData.objects[t].list.length;n++)z.options.basicData.objects[t].list[n].y=-1*Number(z.options.basicData.objects[t].list[n].y);null!=z.options.basicData.objects[t].skew&&null!=z.options.basicData.objects[t].skew&&("X"==z.options.basicData.objects[t].skew?z.options.basicData.objects[t].skew="Y":"Y"==z.options.basicData.objects[t].skew?z.options.basicData.objects[t].skew="X":"ZX"==z.options.basicData.objects[t].skew?z.options.basicData.objects[t].skew="ZY":"ZY"==z.options.basicData.objects[t].skew&&(z.options.basicData.objects[t].skew="ZX"))}for(t=0;t<z.options.joinDotsPos.length;t++)z.options.joinDotsPosData[t].y=-1*Number(z.options.joinDotsPosData[t].y),z.options.joinDotsPos[t].y=z.options.joinDotsPosData[t].y*z.options.height/100,"NW"==z.options.joinDotsPosData[t].dir?z.options.joinDotsPosData[t].dir="Sw":"N"==z.options.joinDotsPosData[t].dir?z.options.joinDotsPosData[t].dir="S":"NE"==z.options.joinDotsPosData[t].dir?z.options.joinDotsPosData[t].dir="SE":"SW"==z.options.joinDotsPosData[t].dir?z.options.joinDotsPosData[t].dir="NW":"S"==z.options.joinDotsPosData[t].dir?z.options.joinDotsPosData[t].dir="N":"SE"==z.options.joinDotsPosData[t].dir&&(z.options.joinDotsPosData[t].dir="NE"),z.options.joinDotsPos[t].dir=z.options.joinDotsPosData[t].dir,z.group.joinDots[t].setAttribute("cy",z.options.joinDotsPos[t].y),z.group.joinDots[t].dir=z.options.joinDotsPosData[t].dir;if(null!=z.options.sizeDotsPosData)for(t=0;t<z.options.sizeDotsPosData.length;t++)z.options.sizeDotsPosData[t].y=-1*Number(z.options.sizeDotsPosData[t].y),z.options.dotsPos[0].y=z.options.sizeDotsPosData[0].y*height/100;z.refresh(3),z.redraw()}},z.setBlockPos=function(t,e){z.set("row",t),z.set("col",e);var o=z.parentLayer.get("rowUnitSize"),s=z.parentLayer.get("colUnitSize"),i=Number((e+t)*o*.5+.5*o),n=Number((-1*t+e)*s*-.5);z.set("x",i),z.set("y",n),z.redraw(4)},z.sortDoms=function(){var t=z.get("row"),e=z.get("col"),o=z.options.d3b,s=z.options.d3a;1!=o&&(o=!1),1!=s&&(s=!1);for(var i=0,n={},a=-1,r=-1,g=z.parentLayer.group.querySelectorAll("[d3=true]"),l=0;l<g.length;l++){var d=g[l].parentNode.fg,u=d.options.row,p=d.options.col,c=d.options.d3b,h=d.options.d3a;if(1!=c&&(c=!1),1!=h&&(h=!1),1!=d.options.layer&&z.options.figureId!=d.options.figureId){if(0==o){if(0!=c)continue;u<t?a<u?(i++,a=u,r=p,n=d,!0):a<=u&&r<p&&(i++,a=u,r=p,n=d,!0):u<=t&&p<=e&&(a<u?(i++,a=u,r=p,n=d,!0):a<=u&&r<p&&(i++,a=u,r=p,n=d,!0))}else if(1==s)if(0==c)a<u?(i++,a=u,r=p,n=d,!0):a<=u&&r<p&&(i++,a=u,r=p,n=d,!0);else{if(1!=h)continue;n=d}else 0==c||1==h?a<u?(i++,a=u,r=p,n=d,!0):a<=u&&r<p&&(i++,a=u,r=p,n=d,!0):u<t?a<u?(i++,a=u,r=p,n=d,!0):a<=u&&r<p&&(i++,a=u,r=p,n=d,!0):u<=t&&p<=e&&(a<u?(i++,a=u,r=p,n=d,!0):a<=u&&r<p&&(i++,a=u,r=p,n=d,!0))}}0==i?z.parentLayer.group.appendChild(z.group):z.parentLayer.group.insertBefore(z.group,n.group)},z.getObjBlockInfo=function(t){t.get("rowBlock"),t.get("colBlock"),t.unitWidth,t.unitHeight;var e=t.get("row")+Math.floor((t.get("rowBlock")-1)/2),o=t.get("row")+Math.ceil((t.get("rowBlock")-1)/2),s=t.get("col")+t.get("colBlock")-1,i=t.get("row"),n=t.get("col")+Math.floor((t.get("colBlock")-1)/2),a=t.get("col")+Math.ceil((t.get("colBlock")-1)/2),r=(t.get("row"),Math.floor((t.get("rowBlock")-1)/2),t.get("row"),Math.ceil((t.get("rowBlock")-1)/2),t.get("col")),g=t.get("row")+t.get("rowBlock")-1;t.get("col"),Math.floor((t.get("colBlock")-1)/2),t.get("col"),Math.ceil((t.get("colBlock")-1)/2);return{cenR:e,cenL:o,colT:s,rowR:i,midT:n,midB:a,colB:r,rowL:g}},z.getBlockPosByRowCol=function(t,e,o,s){var i=!1;t%1==.5&&(t-=.5,i=!0);var n=!1;e%1==.5&&(e-=.5,n=!0);var a=45*t*-1+45*e,r=30*t*-1+30*e*-1;if(1==i&&1==n)a=(a+(45*(t+1)*-1+45*(e+1)))/2,r=(r+(30*(t+1)*-1+30*(e+1)*-1))/2;else if(1==i){a=(a+(45*(t+1)*-1+45*e))/2,r=(r+(30*(t+1)*-1+30*e*-1))/2}else if(1==n){a=(a+(45*t*-1+45*(e+1)))/2,r=(r+(30*t*-1+30*(e+1)*-1))/2}var g=a,l=r-30;return null!=o&&(g=(a+=o)+o),null!=s&&(r+=s,l+=s),{x:a,y:r,centerX:g,centerY:l}},z.getBlockPosByObjsRowCol=function(t,e,o){var s=t.get("rowBlock"),i=t.get("colBlock"),n=t.unitWidth,a=t.unitHeight,r=e*n*-1+o*n,g=e*a*-1+o*a*-1,l=(e+s)*n*-1+(o+i)*n,d=(e+s)*a*-1+(o+i)*a*-1;return{left:l,right:r,bottom:g,top:d,centerX:(r+l)/2,centerY:(g+d)/2,rowBlock:s,colBlock:i,rowBlockSize:rowBock*n,colBlockSize:i*a}},z.setBlockPosByXY=function(t,e){var o=9*Math.floor(t/9);4.5<t%9&&(o+=9);var s=6*Math.floor(e/6);3<e%6&&(s+=6),z.options.x=o,z.options.y=s,setTagsShape(z,z.options,!1,4),setJoinDotsPos(z),z.moveJoinDots(),z.draw(128),z.drawText(1)},z.setBlockPosByXYOld=function(t,e){if(null!=z.parentLayer&&1==z.parentLayer.options.layer3d){var o=z.parentLayer.get("rowUnitSize"),s=z.parentLayer.get("colUnitSize");e+=100,e*=-1;var i=Math.floor(t/o+e/s),n=Math.floor(e/s-t/o);z.setBlockPos(n,i)}else z.options.x=t,z.options.y=e;setTagsShape(z,z.options,!1,5),setJoinDotsPos(z),z.moveJoinDots(),z.draw(129),z.drawText(1)},z.resizePointTo3D=function(t,e,o){null!=z.get("resizable")&&1==z.get("resizable")&&sedLib.resizePointTo3D(z,t,e,o)},z.resizePointToLayer3D=function(t,e,o){sedLib.resizePointToLayer3D(z,t,e,o)},z.setRotate3D=function(){sedLib.setRotate3D(z)},z.setDotsPos=function(){if(null!=z.group.dots)for(var t=0;t<z.group.dots.length;t++)z.group.dots[t].setAttribute("cx",z.options.dotsPosCalc[t].x),z.group.dots[t].setAttribute("cy",z.options.dotsPosCalc[t].y)},z.setJoinDotsPos=function(){if(null!=z.group.joinDots)for(var t=0;t<z.group.joinDots.length;t++)z.group.joinDots[t].setAttribute("cx",z.options.joinDotsPosCalc[t].x),z.group.joinDots[t].setAttribute("cy",z.options.joinDotsPosCalc[t].y)}};